import{_ as e,a0 as o,bL as t,s as a,n as s,T as l,U as n,V as r,bM as i,bK as d,ba as m,r as c,c as g,i as u,w as p,b as h,d as f,q as b,W as y,a4 as w,X as _,o as S,g as C,k as x,t as M}from"./index-FwbBwjbJ.js";import{m as V}from"./md5.6s00qotZ.js";const I=e({props:{type:{type:Number,default:0}},data:()=>({formModel:{password:"",passwordAgain:"",smscode:""},formRules:{password:[{type:"string",required:!0,message:"请输入新密码",min:6,trigger:["blur"]},{min:6,message:"密码太短",trigger:["change","blur"]}],passwordAgain:[{type:"string",required:!0,message:"请确认新密码",trigger:["blur"]},{min:6,message:"密码太短",trigger:["change","blur"]}],smscode:{type:"string",required:!0,message:"请输入验证码",trigger:["blur"]}},smsKey:null,codeText:"",canSee1:!1,canSee2:!1}),onReady(){this.$refs.uForm.setRules(this.formRules)},onLoad(e){console.log(JSON.stringify(o.state.loginInfo)),1==this.type?t({title:"修改登录密码"}):t({title:"修改支付密码"})},methods:{codeChange(e){this.codeText=e},getCode(){if(null==o.state.loginInfo)return a({title:"请先登录",icon:"error"}),void s({url:"/pages/login/login"});this.$refs.uCode.canGetCode&&(l({title:"正在获取验证码"}),n(o.state.loginInfo.phone).then((e=>{r(),200==e.code?(a({title:"验证码已发送"}),this.$refs.uCode.start(),this.smsKey=e.data.code):a({title:"验证码发送失败",icon:"error"})})).catch((e=>{r(),a({title:"验证码发送失败",icon:"error"})})))},submit(){let e,t;e=this.formModel.password,t=this.formModel.passwordAgain,0!=e.length&&0!=t.length?e.length<6||t.length<6?a({title:"输入密码太短",icon:"error"}):e==t?null!=this.smsKey?0!=this.formModel.smscode.length?(l({mask:!0,title:"正在提交"}),i(o.state.loginInfo.phone,this.formModel.smscode,this.smsKey).then((s=>{if(200!=s.code)return r(),void a({title:s.msg,icon:"error"});let l={};1==this.type?(l.password=V.md5(e),l.newpassword=V.md5(t),l.tenantid=o.state.loginInfo.tenant_id,l.phone=o.state.loginInfo.phone):(l.payPassword=V.md5(e),l.newPayPassword=V.md5(t),l.tenantid=o.state.loginInfo.tenant_id,l.phone=o.state.loginInfo.phone),this.apiSubmit(l)})).catch((e=>{console.log(JSON.stringify(e)),r()}))):a({title:"请输入验证码",icon:"error"}):a({title:"请获取验证码",icon:"error"}):a({title:"两次输入的密码不一致",icon:"error"}):a({title:"请输入密码",icon:"error"})},apiSubmit(e){d(e).then((e=>{if(200!=e.code)return r(),void a({title:e.msg,icon:"error"});m({url:"/pages/mine/setting/success"})})).catch((e=>{a({icon:"error",title:"提交失败"})})).finally((e=>{r()}))}}},[["render",function(e,o,t,a,s,l){const n=c(g("u-input"),h),r=c(g("u-icon"),f),i=b,d=c(g("u-form-item"),y),m=c(g("u-code"),w),V=c(g("u--form"),_);return S(),u(i,{class:"zot-full-page"},{default:p((()=>[C(i,{class:"z-mine-setion",style:{padding:"0 30rpx 0 30rpx"}},{default:p((()=>[C(V,{class:"u-p-t-12 u-p-b-12",ref:"uForm",model:s.formModel,labelPosition:"left",labelStyle:{"font-weight":500,color:"#292A2B"},labelWidth:"auto"},{default:p((()=>[C(d,{labelWidth:"auto",label:"新的密码",prop:"idname",borderBottom:""},{default:p((()=>[C(n,{modelValue:s.formModel.password,"onUpdate:modelValue":o[0]||(o[0]=e=>s.formModel.password=e),border:"none",placeholder:"请输入","input-align":"right",password:!s.canSee1,clearable:"",maxlength:1==t.type?"10":"6"},null,8,["modelValue","password","maxlength"]),C(i,{class:"u-m-l-16",onClick:o[1]||(o[1]=e=>s.canSee1=!s.canSee1)},{default:p((()=>[C(r,{name:s.canSee1?"/static/image/common/eye_open.png":"/static/image/common/eye_close.png",width:"14",height:s.canSee1?11:7},null,8,["name","height"])])),_:1})])),_:1}),C(d,{label:"确认密码",prop:"idcard",borderBottom:""},{default:p((()=>[C(n,{modelValue:s.formModel.passwordAgain,"onUpdate:modelValue":o[2]||(o[2]=e=>s.formModel.passwordAgain=e),border:"none",placeholder:"请输入","input-align":"right",password:!s.canSee2,clearable:"",maxlength:1==t.type?"10":"6"},null,8,["modelValue","password","maxlength"]),C(i,{class:"u-m-l-16",onClick:o[3]||(o[3]=e=>s.canSee2=!s.canSee2)},{default:p((()=>[C(r,{name:s.canSee2?"/static/image/common/eye_open.png":"/static/image/common/eye_close.png",width:"14",height:s.canSee2?11:7},null,8,["name","height"])])),_:1})])),_:1}),C(d,{label:"短信验证码",prop:"smscode",borderBottom:""},{default:p((()=>[C(n,{class:"u-m-r-20",modelValue:s.formModel.smscode,"onUpdate:modelValue":o[4]||(o[4]=e=>s.formModel.smscode=e),border:"none",placeholder:"请输入","input-align":"right",type:"number",clearable:""},null,8,["modelValue"]),C(m,{ref:"uCode",seconds:60,changeText:"X秒",onChange:l.codeChange},null,8,["onChange"]),C(i,{style:{color:"#2647FF"},onClick:l.getCode},{default:p((()=>[x(M(s.codeText),1)])),_:1},8,["onClick"])])),_:1})])),_:1},8,["model"])])),_:1}),C(i,{class:"z-mine-submit-btn",style:{"margin-top":"100rpx"},onClick:l.submit},{default:p((()=>[x("确认")])),_:1},8,["onClick"])])),_:1})}],["__scopeId","data-v-26693921"]]);export{I as default};
