import{ak as t,_ as e,o as a,i as s,w as i,g as n,y as o,q as r,r as l,d,c,k as p,t as u,j as m,f as h,F as y,l as f,p as g,aM as x,A as w,S as b,h as _,m as A,Q as k,by as D,bz as B,H as L,a9 as I}from"./index-B3fvMXoi.js";import{_ as M}from"./l-floating-panel.Dh4psWJI.js";import{_ as T}from"./uv-skeletons.B5flGH1a.js";import{_ as C}from"./z-paging.Ctbk3ePi.js";import{M as S,S as v}from"./constants.mpH2PV74.js";const H={data:()=>({map:null,markerList:[],polylineList:[],driving:null}),mounted(){if(window._AMapSecurityConfig={securityJsCode:this.code},"function"==typeof window.AMap)this.initAmap();else{const t=document.createElement("script");t.src="https://webapi.amap.com/maps?v=2.0&key="+this.key+"&plugin=AMap.Driving",t.onload=this.initAmap.bind(this),document.head.appendChild(t)}},methods:{initAmap(t,e){this.map=new AMap.Map("container",{zoom:12,center:[116.40449,39.900773],mapStyle:"amap://styles/whitesmoke",viewMode:"2D"}),this.driving=new AMap.Driving({map:this.map,hideMarkers:!0,showTraffic:!1,autoFitView:!1})},getMarkerColor(t,e){if("transit"===t&&e)return{railway:"#FF4D4F",truck:"#67C23A",port:"#2647FF"}[e]||"#E6A23C";return{start:"#00CB40",end:"#FAAD14",center:"#7653D6"}[t]||"#7653D6"},getMarkerIcon(t,e){if("center"===t&&e)return{railway:"/static/image/onway/annation_railway.png",car:"/static/image/onway/annation_car.png",port:"/static/image/onway/annation_ship.png"}[e]||"/static/image/onway/map_transit.png";return{start:"/static/image/onway/map_start.png",end:"/static/image/onway/map_end.png"}[t]||"/static/image/onway/map_transit.png"},async updateMarkers(t){this.map&&t.length&&(this.clearMarkers(),this.clearPolylines(),t.forEach((t=>{const e=this.getMarkerColor(t.type,t.transitType),a=new AMap.Marker({position:new AMap.LngLat(t.longitude,t.latitude),icon:new AMap.Icon({image:this.getMarkerIcon(t.type,t.transitType),imageSize:"center"==t.type?new AMap.Size(20,20):new AMap.Size(20,34)}),anchor:"bottom-center",label:{content:`<div style="display: flex; flex-direction: row; align-items: center; background: white; border-radius: 4px; box-shadow: 0 2px 6px rgba(0,0,0,0.1);">\n\t\t\t\t\t\t\t\t<div style="padding: 8px 8px; border-radius: 4px 0 0 4px; color: white; font-size: 12px; background-color: ${e};">\n\t\t\t\t\t\t\t\t\t${t.typeText}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div style="padding: 8px; font-size: 12px; color: #333;">\n\t\t\t\t\t\t\t\t\t${t.name}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>`,direction:"top",offset:new AMap.Pixel(0,-5)}});a.on("click",(()=>{this.handleMarkerClick(t)})),this.markerList.push(a),this.map.add(a)})),await this.planRoute(t),this.map.setFitView([...this.markerList,...this.polylineList]))},async planRoute(t){if(!(t.length<2))for(let e=0;e<t.length-1;e++){const a=t[e],s=t[e+1];let i="#999999";1==s.transType?i="#00CB40":2==s.transType?i="#ff0000":3==s.transType&&(i="#2647FF"),await new Promise(((t,e)=>{this.driving.search(new AMap.LngLat(a.longitude,a.latitude),new AMap.LngLat(s.longitude,s.latitude),{showTraffic:!1},((a,s)=>{if("complete"===a){const e=s.routes[0],a=e.steps.map((t=>t.path)).flat();e.distance;const n=new AMap.Polyline({path:a,strokeColor:i,strokeWeight:6,strokeStyle:"solid",lineJoin:"round",lineCap:"round",strokeOpacity:1,zIndex:50,showDir:!0});this.polylineList.push(n),this.map.add(n),t()}else e(new Error("路线规划失败"))}))})).catch((t=>{console.error("规划路线错误:",t)}))}},clearMarkers(){this.markerList.length>0&&(this.map.remove(this.markerList),this.markerList=[])},clearPolylines(){this.polylineList.length>0&&(this.map.remove(this.polylineList),this.polylineList=[])},handleMarkerClick(t){this.$ownerInstance.callMethod("onMarkerClick",t)}}},N=t=>{t.$renderjs||(t.$renderjs=[]),t.$renderjs.push("renderJS"),t.mixins||(t.mixins=[]),t.mixins.push({beforeCreate(){this.renderJS=this},mounted(){this.$ownerInstance=this.$gcd(this,!0)}}),t.mixins.push(H)},z={props:{windowHeight:{type:Number,default:t().windowHeight},markers:{type:Array,default:()=>[]},polylines:{type:Array,default:()=>[]}},data:()=>({key:S,code:v,type:"枢",name:"大理商贸服务型国家物流枢纽"}),watch:{markers:{handler(t){this.$ownerInstance.callMethod("updateMarkers",t)},deep:!0},polylines:{handler(t){this.$ownerInstance.callMethod("updatePolylines",t)},deep:!0}},methods:{},mounted(){}};N(z);const F=e({components:{mapRender:e(z,[["render",function(t,e,l,d,c,p){const u=r;return a(),s(u,null,{default:i((()=>[n(u,{id:"container",class:"map",style:o([{height:l.windowHeight+"rpx"},{width:"100%"}])},null,8,["style"])])),_:1})}]]),onwayInfo:e({props:{timeLines:{type:Array,default:()=>[]}},components:{onwayInfoItem:e({props:{item:{type:Object,default:{}}},methods:{expandItem(t){t.expanded=!t.expanded}}},[["render",function(t,e,x,w,b,_){const A=l(c("u-icon"),d),k=g,D=r;return a(),s(D,{style:{"background-color":"#fff"}},{default:i((()=>["start"==x.item.type?(a(),s(D,{key:0,class:"owayi-item-top"},{default:i((()=>[n(A,{name:"map-fill",color:"#00CB40"}),n(k,{class:"owayi-item-top__title"},{default:i((()=>[p(u(x.item.title),1)])),_:1}),n(k,{class:"owayi-item-top__time"},{default:i((()=>[p("起运时间："+u(x.item.time),1)])),_:1})])),_:1})):"center"==x.item.type?(a(),s(D,{key:1,class:"owayi-item-top"},{default:i((()=>[n(D,{class:"owayi-item-top__circle"}),n(k,{class:"owayi-item-top__title"},{default:i((()=>[p(u(x.item.title),1)])),_:1}),n(k,{class:"owayi-item-top__time"},{default:i((()=>[p("完成时间："+u(x.item.time),1)])),_:1})])),_:1})):"end"==x.item.type?(a(),s(D,{key:2,class:"owayi-item-top"},{default:i((()=>[n(A,{name:"map-fill",color:"#FAAD14"}),n(k,{class:"owayi-item-top__title"},{default:i((()=>[p(u(x.item.title),1)])),_:1}),n(k,{class:"owayi-item-top__time"},{default:i((()=>[p("物流段未进行")])),_:1})])),_:1})):m("",!0),"end"!=x.item.type?(a(),s(D,{key:3,class:"owayi-item-center"},{default:i((()=>[n(D,{class:"owayi-item-line",style:{"z-index":"1"}}),n(D,{style:{"z-index":"2"}},{default:i((()=>[n(D,{class:"owayi-item-head"},{default:i((()=>[n(D,{class:"owayi-item-center__icon"}),n(D,{class:"owayi-item-center__type"},{default:i((()=>[n(A,{name:"list",color:"#00CB40",size:"40rpx",label:x.item.transTypeStr,"label-color":"#00CB40","label-size":"24rpx"},null,8,["label"])])),_:1}),n(D,{style:{flex:"1"}}),n(D,{class:"owayi-item-center__expand",onClick:e[0]||(e[0]=t=>_.expandItem(x.item)),style:o({color:x.item.expanded?"#2647ff":"#666E81"})},{default:i((()=>[p("物流详情 "),n(A,{class:"u-m-l-10",name:x.item.expanded?"arrow-up":"arrow-down",size:"20rpx",color:x.item.expanded?"#2647ff":"#666E81"},null,8,["name","color"])])),_:1},8,["style"])])),_:1}),x.item.expanded?(a(),s(D,{key:0},{default:i((()=>[(a(!0),h(y,null,f(x.item.child,((t,e)=>(a(),s(D,{key:e,class:"u-m-l-14"},{default:i((()=>[n(D,{class:"u-flex u-flex-items-center u-m-t-20"},{default:i((()=>[n(D,{class:"owayi-item-center-circle"}),n(k,{class:"owayi-item-center-title"},{default:i((()=>[p(u(t.address),1)])),_:2},1024)])),_:2},1024),n(D,{class:"owayi-item-center-time"},{default:i((()=>[p(u(t.transportTime),1)])),_:2},1024),n(D,{class:"owayi-item-center-desc"},{default:i((()=>[p(u(t.message),1)])),_:2},1024)])),_:2},1024)))),128))])),_:1})):m("",!0)])),_:1})])),_:1})):m("",!0)])),_:1})}],["__scopeId","data-v-ce6b62e4"]])},watch:{timeLines:{handler(){},immediate:!0}},data(){const e=t();return{windowHeight:e.windowHeight,scrollHeight:.6*e.windowHeight,pushSwitch:!0,timeLinesTest:[{type:"start",title:"坪石站仓储站点",time:"09-28 03:15",status:"已到站",info:"货物到达【坪石站】完成卸载，准备发往【木根桥站】。",expanded:!1},{type:"center",title:"坪石站",transType:1,transTypeStr:"短途汽运",time:"09-28 03:15",status:"已到站",info:"货物到达【坪石站】完成卸载，准备发往【木根桥站】。",expanded:!1,child:[{title:"已到站",desc:"货物到达【坪石站】完成卸载，准备发往【木根桥站】。",time:"2025-04-15 10:34:13"},{title:"已到站",desc:"货物到达【坪石站】完成卸载，准备发往【木根桥站】。",time:"2025-04-15 10:34:13"},{title:"已到站",desc:"货物到达【坪石站】完成卸载，准备发往【木根桥站】。",time:"2025-04-15 10:34:13"},{title:"已到站",desc:"货物到达【坪石站】完成卸载，准备发往【木根桥站】。",time:"2025-04-15 10:34:13"},{title:"已到站",desc:"货物到达【坪石站】完成卸载，准备发往【木根桥站】。",time:"2025-04-15 10:34:13"}]}]}}},[["render",function(t,e,d,u,m,_){const A=g,k=l(c("u-switch"),x),D=r,B=w("onwayInfoItem"),L=b;return a(),s(D,{class:"u-p-l-20 u-p-r-20"},{default:i((()=>[n(D,{class:"u-flex u-flex-items-center u-p-l-20"},{default:i((()=>[n(A,{class:"owayi-title"},{default:i((()=>[p("在途详情")])),_:1}),n(A,{class:"owayi-title-desc u-m-r-10"},{default:i((()=>[p("开启推送")])),_:1}),n(k,{modelValue:m.pushSwitch,"onUpdate:modelValue":e[0]||(e[0]=t=>m.pushSwitch=t),activeColor:"#2647ff",size:"21"},null,8,["modelValue"])])),_:1}),n(L,{"scroll-y":"",style:o("height:"+(m.scrollHeight-90)+"px")},{default:i((()=>[(a(!0),h(y,null,f(d.timeLines,((t,e)=>(a(),s(D,{key:e},{default:i((()=>[n(B,{item:t},null,8,["item"])])),_:2},1024)))),128))])),_:1},8,["style"])])),_:1})}],["__scopeId","data-v-0a0fad82"]]),onwayBoxBar:e({emits:["boxTabChange"],props:{boxList:{type:Array,default:[]}},data:()=>({tabIndex:0}),watch:{boxList:{handler(){this.tabIndex=0},immediate:!0}},computed:{sliderStyle(){return{width:"208rpx",left:208*this.tabIndex+20*this.tabIndex+104+"rpx"}}},methods:{changeTab(t){this.tabIndex=t,this.$emit("boxTabChange",t)}}},[["render",function(t,e,m,g,x,w){const k=A,D=r,B=l(c("u-icon"),d),L=b;return a(),s(D,null,{default:i((()=>[n(L,{class:"obbtab-srcoll","scroll-x":!0,"scroll-left":0,"show-scrollbar":!1},{default:i((()=>[(a(!0),h(y,null,f(m.boxList,((t,e)=>(a(),s(D,{class:"obbtab-item-bg",key:e,onClick:t=>w.changeTab(e)},{default:i((()=>[n(D,{class:_(["obbtab-item",{active:x.tabIndex===e}])},{default:i((()=>[n(k,{src:(x.tabIndex,"/static/image/onway/box_black.png"),style:{width:"42rpx",height:"42rpx"}},null,8,["src"]),n(D,{class:"obbtab-item-info"},{default:i((()=>[n(D,{style:{color:"#333","font-weight":"500","font-size":"26rpx"}},{default:i((()=>[p(u(t.name),1)])),_:2},1024),n(D,{style:{color:"#333","font-size":"22rpx"}},{default:i((()=>[p(u(t.status),1)])),_:2},1024)])),_:2},1024)])),_:2},1032,["class"])])),_:2},1032,["onClick"])))),128)),n(B,{class:"obbtab-slider",style:o(w.sliderStyle),name:"arrow-up-fill",color:"#fff",size:"26rpx"},null,8,["style"])])),_:1})])),_:1})}],["__scopeId","data-v-521c699a"]])},data(){const{windowHeight:e}=t();return{orderNo:null,isDetailsVisible:!0,skeleton:[{type:"line",num:3,gap:"20rpx",style:["width: 200rpx;marginTop: 50rpx;marginLeft: 30rpx;","marginLeft: 30rpx;marginRight: 30rpx;","width: 400rpx;marginBottom: 50rpx;marginLeft: 30rpx;"]}],markers:[],anchors:[200,Math.round(.6*e)],mapHeight:2*(e-450),loading:!1,boxLoading:!1,orderData:null,boxesStr:null,boxes:[],currentBox:-1,boxData:[],boxTabs:[],boxShowData:[]}},onLoad(t){this.orderNo=t.orderNo,this.queryOrders()},methods:{onRefresh(){},goBack(){k()},queryOrders(){const t={orderNos:this.orderNo};this.loading=!0,D(t).then((t=>{this.loading=!1,this.orderData=t.data[0];let e=this.orderData.statusDto.all,a=e.boxNos.split(",");this.boxesStr=e.boxNos,this.boxes=a,this.queryBoxInfo()})).catch((t=>{this.loading=!1}))},queryBoxInfo(){if(this.boxesStr){const t={orderNo:this.orderNo,boxNos:this.boxesStr};this.boxLoading=!0,B(t).then((t=>{this.boxLoading=!1,this.boxData=t.data,this.configApiData(0)})).catch((t=>{this.boxLoading=!1}))}},configApiData(t){const e=["一","二","三","四","五","六","七","八","九"];let a=[];for(var s=0;s<this.boxData.length;s++){const t=this.boxData[s];let n=s>9?s:e[s];var i="-";1==t.status?i="待运输":2==t.status?i="在途中":3==t.status&&(i="已完成"),a.push({name:"箱号"+n,status:i})}this.boxTabs=a,t>=0&&this.changeBoxIndex(t);const n=this.orderData.realList;let o=[];for(s=0;s<n.length;s++){const t=n[s];let e={longitude:t.lon,latitude:t.lat,name:t.address,transType:1};0==s?(e.type="start",e.typeText="起"):s==n.length-1?(e.type="end",e.typeText="终"):(e.type="center",e.typeText="中"),e.transitType="car",o.push(e)}this.markers=o},changeBoxIndex(t){if(t<this.boxData.length){this.currentBox=t;const s=this.boxData[t],i=this.orderData.realList;let n=[];for(var e=1;e<i.length;e++){const t=i[e-1];let o={};o.type=1==e?"start":"center",o.title=t.address,o.transType=1,o.transTypeStr="汽运",o.expanded=!1;let r=[];for(var a=s.transportDtoList.length-1;a>0;a--){const t=s.transportDtoList[a];t.sort==e&&r.push(t)}o.child=r,n.push(o)}{const t=i[i.length-1];let e={type:"end"};e.title=t.address,e.transType=1,e.transTypeStr="汽运",e.expanded=!1,n.push(e)}this.boxShowData=n}},orderSatus(){if(!this.orderData)return"加载中...";let t=this.orderData.statusDto.all,e=this.orderData.statusDto.completed;return t.num==e.num?"已完成":"进行中"},getAddress(t,e){if(!this.boxData)return"加载中...";const a=this.boxData[this.currentBox];for(var s=0;s<a.transportDtoList.length;s++){const i=a.transportDtoList[s];if(i.sort==s+1)return t?e?i.startAddress:i.startAddressStr:e?i.endAddress:i.endAddressStr}},boxStatus(t){if(!this.boxData)return"加载中...";{const e=this.boxData[this.currentBox];if(1==e.status)return t?"#292A2B":"待运输";if(2==e.status)return t?"#292A2B":"在途中";if(3==e.status)return t?"#292A2B":"完成"}}}},[["render",function(t,e,o,h,y,f){const x=r,b=l(c("u-status-bar"),L),_=l(c("u-icon"),d),k=l(c("u-sticky"),I),D=A,B=g,S=w("onwayBoxBar"),v=w("mapRender"),H=w("onwayInfo"),N=l(c("l-floating-panel"),M),z=l(c("uv-skeletons"),T),F=l(c("z-paging"),C);return a(),s(F,{ref:"paging",style:{"background-color":"#f0f2f7"}},{default:i((()=>[n(x,{class:"onway"},{default:i((()=>[n(x,{class:"onway-gradient-bg"}),n(k,{customNavHeight:0},{default:i((()=>[n(x,{class:"onway-bar"},{default:i((()=>[n(b),n(x,{class:"onway-custom-nav"},{default:i((()=>[n(x,{class:"nav-back-bg",onClick:f.goBack},{default:i((()=>[n(_,{name:"arrow-left",color:"white",size:"18"})])),_:1},8,["onClick"]),n(x,{class:"nav-title"},{default:i((()=>[p("在途跟踪")])),_:1}),n(x,{style:{height:"100%"}})])),_:1})])),_:1})])),_:1}),n(z,{loading:y.loading,animate:!0,skeleton:y.skeleton},{default:i((()=>[y.orderData?(a(),s(x,{key:0},{default:i((()=>[n(x,{class:"onway-order"},{default:i((()=>[n(D,{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAYCAMAAADNlS1EAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAFBUExURUdwTCZG/yZH/yZH/yZH/yZH/yZH/yZI/yBA/yVH/wAA/yVH/wAA/yZH/yZH/ydI/yZG/yZI/8PS/7/M/+rz/9Pe/2t5/6i3//P2/////+fz/7C+/9Pd//Dw//////H3/87Z/yRI/yZI/yVH/ypV/yZH/yZH//D2/8vW/4OY/2B6/5Sm/4uf/9Te/ydI/1dx/0Bd/y1N/3+U/zxa/3eN/0hl/5us/1l0/yhJ/zZV/y9O/ylJ/36U/5qr/8DN/6e3/5Gj/8LO/2uD/zVU/2F6/4md/8nU/+Hp/1Vw/194/zRT/5Wn/2d//6Ky/5Kl/46h/z1b/22E/5+w/1Fs/2uC/26F/7nG/8/Z/8jU/0pm/+jv/0Zk/8HN/5Ol/y5O/8rW/0Rh/+rx/154/4CV/+fv/z1a/+30/0Fe/0Zj/113/1Zx/02Dn3kAAAAmdFJOUwCcL/hd+8WUCI8B1AL5wif6vUT7j3QT8lQBFcnjIgNcp1WNiQbtbYphCwAAAMNJREFUGNNjYGBgkBIR9tMBgyAZeTkGMJCUEA9Qg4IQBVmwGI+YqD9MTC1YWoiDi4GBiVvPx9cAJhjobcDMyMHApqbm7GBnpg0G9o5OFmpqLAysQHlDcyNNMDAx1QNyORnUMAE75YLWnjG6IBBmhSToFasOBomhSIJxyWlgwZQEZDMNM/SBICudoEV6qZlaEJAUrQcTjIxXh4FwF5igRxRc0N0GJmjpGqEBAW62xqR6kxdTUIlBEFNQkYGfTwBVSFVZBQAZNUrYCejP8gAAAABJRU5ErkJggg==",style:{width:"22rpx",height:"24rpx"}}),n(B,{class:"onway-order__title"},{default:i((()=>[p("订单编号："+u(y.orderData.productNo),1)])),_:1}),n(_,{name:"/static/image/onway/gray_copy.png",size:"24rpx"}),n(B,{class:"onway-order__status"},{default:i((()=>[p("已完成：")])),_:1}),n(B,{class:"onway-order__progress"},{default:i((()=>[p(u(y.orderData.statusDto.completed.num)+"/"+u(y.orderData.statusDto.all.num),1)])),_:1})])),_:1})])),_:1})):m("",!0),n(S,{class:"u-m-t-30 u-m-l-30 u-m-r-30",boxList:y.boxTabs,onBoxTabChange:f.changeBoxIndex},null,8,["boxList","onBoxTabChange"]),y.currentBox>=0?(a(),s(x,{key:1,class:"order-container"},{default:i((()=>[n(x,{class:"order-header"},{default:i((()=>[n(x,{class:"order-number"},{default:i((()=>[p(" 箱号编码："),n(B,{class:"number"},{default:i((()=>[p(u(y.boxData[y.currentBox].boxNo),1)])),_:1})])),_:1}),n(x,{class:"expand-button",onClick:e[0]||(e[0]=t=>y.isDetailsVisible=!y.isDetailsVisible)},{default:i((()=>[p(u(y.isDetailsVisible?"收起":"展开")+" ",1),n(_,{style:{"margin-left":"6rpx"},name:y.isDetailsVisible?"arrow-up":"arrow-down",size:"12",color:"#292A2B"},null,8,["name"])])),_:1})])),_:1}),y.isDetailsVisible?(a(),s(x,{key:0,class:"order-details"},{default:i((()=>[n(x,{class:"station-info"},{default:i((()=>[n(x,{class:"start-station"},{default:i((()=>[n(B,{class:"station-name"},{default:i((()=>[p(u(f.getAddress(!0,!0)),1)])),_:1}),n(B,{class:"station-desc"},{default:i((()=>[p(u(f.getAddress(!0,!1)),1)])),_:1})])),_:1}),n(B,{class:"arrow"},{default:i((()=>[p("→")])),_:1}),n(x,{class:"end-station"},{default:i((()=>[n(B,{class:"station-name"},{default:i((()=>[p(u(f.getAddress(!1,!0)),1)])),_:1}),n(B,{class:"station-desc"},{default:i((()=>[p(u(f.getAddress(!1,!1)),1)])),_:1})])),_:1}),n(x,{class:"status-info"},{default:i((()=>[n(B,{class:"status"},{default:i((()=>[p(u(f.boxStatus(!1)),1)])),_:1})])),_:1})])),_:1})])),_:1})):m("",!0)])),_:1})):m("",!0),n(x,{class:"u-m-t-20"},{default:i((()=>[n(v,{markers:y.markers,windowHeight:y.mapHeight},null,8,["markers","windowHeight"])])),_:1}),n(N,{"content-draggable":!1,anchors:y.anchors},{default:i((()=>[n(H,{timeLines:y.boxShowData},null,8,["timeLines"])])),_:1},8,["anchors"])])),_:1},8,["loading","skeleton"])])),_:1})])),_:1},512)}],["__scopeId","data-v-3208d31e"]]);export{F as default};
