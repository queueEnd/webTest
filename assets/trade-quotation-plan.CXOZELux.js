import{_ as t,s as o,aT as e,n as a,aQ as n,r as i,K as l,c as s,bu as c,A as u,o as r,f as d,g as h,w as f,k as p,t as g,F as m,l as y,i as x,j as q,ai as w,q as _,p as Q,m as b}from"./index-B3fvMXoi.js";import{t as k}from"./trade-quote-price.b77gy01x.js";import{t as A,u as C,v as S}from"./zhdnTradeApi.Dx0rs8q0.js";const T=t({components:{tradeQuotationPrice:k},emits:["reload"],props:{canEdit:{type:Boolean,default:!0},quotation:{type:Object,default:null},sourceData:{type:Object,default:null}},data:()=>({tool:{canAgreeQutation:!1,canQuotation:!1,canDisable:!1,canAgreeEnd:!1,canQuotationNext:!1},showModal:!1,supplierAgreeHtml:"",modalText:"",actionType:0,showQuotationPop:!1,toQuoteCopyItem:null,onlySeeSee:!1}),watch:{quotation:{handler(){if(this.quotation){const t=this.quotation.bargainingRecord[0];this.quotation.nowQuote=t;let o="";this.quotation.nowQuote.priceScheme.containerInfo.forEach((t=>{o.length,o=o+t.product+"*"+t.productNum})),this.quotation.boxCountInfo=o;const e=this.quotation.checkStatus;this.quotation.statusIcon=4==e?"/static/image/trade/trade_plan_end.png":5==e?"/static/image/trade/trade_plan_giveup.png":"/static/image/trade/trade_plan_ing.png",4==e||5==e||(this.quotation.isSendPriceBySelf?-1!=t.roleType.indexOf("我方")?(this.tool.canAgreeQutation=!1,this.tool.canQuotation=!1,this.tool.canDisable=!1,this.tool.canAgreeEnd=!1,this.tool.canQuotationNext=!0):(this.tool.canAgreeQutation=!0,this.tool.canQuotation=!0,this.tool.canDisable=!1,this.tool.canAgreeEnd=!1,this.tool.canQuotationNext=!1):this.sourceData.isCreateBySelf?-1!=t.roleType.indexOf("我方")?(this.tool.canAgreeQutation=!1,this.tool.canQuotation=!1,this.tool.canDisable=!0,this.tool.canAgreeEnd=!1,this.tool.canQuotationNext=!0):(this.tool.canAgreeQutation=!1,this.tool.canQuotation=!0,this.tool.canDisable=!0,this.tool.canAgreeEnd=!0,this.tool.canQuotationNext=!1):this.onlySeeSee=!0),this.simplyQuoteModelInfo()}},immediate:!0}},methods:{closeModal(){this.showModal=!1},simplyQuoteModelInfo(){const t=[],o=this.quotation.nowQuote.priceScheme;let e="";if(o.containerInfo.forEach((t=>{e.length>0&&(e+="\n"),e+=`${t.product}*${t.productNum} 预计装载量 ${t.productWeight}吨`})),t.push({title:"装载方案:",value:e}),t.push({title:"折合单价:",value:o.freight+"元/"+o.priceUnit}),t.push({title:"合计总价:",value:"￥"+o.totalPrice}),this.quotation.planInfo=t,this.quotation.bargainingRecord.length>1){const t=this.quotation.bargainingRecord[0].priceScheme,o=this.quotation.bargainingRecord[1].priceScheme,e=[];for(var a=0;a<t.containerInfo.length;a++){const l=t.containerInfo[a];for(var n=null,i=0;i<o.containerInfo.length;i++){const t=o.containerInfo[i];t.product==l.product&&(n=t)}if(!n)continue;const s={};let c="";l.productWeight!=n.productWeight&&(s.fromLoad=n.productWeight,s.toLoad=l.productWeight,c+=`载重量调整:<span style="font-weight: 500;color:#FF0003">${s.fromLoad}吨</span> → <span style="font-weight: 500;color:#FF0003">${s.toLoad}吨</span>`),l.price!=n.price&&(s.fromPrice=n.price,s.toPrice=l.price,c.length>0&&(c+="，"),c+="箱型/车型单价调整:",c+=`<span style="font-weight: 500;color:#FF0003">￥${s.fromPrice}</span>`,c+=" → ",c+=`<span style="font-weight: 500;color:#FF0003">￥${s.toPrice}</span>`),(s.fromPrice||s.fromLoad)&&(s.htmlText=`【${n.product}】${c}`,e.push(s))}e.length>0&&(this.quotation.changeInfo=e)}},toQuotation(){if(!this.tool.canQuotation){let t="暂时不能报价";return t=4==this.quotation.checkStatus||5==this.quotation.checkStatus?"报价已结束，不能继续议价":"已提交报价，等待对方确认",void o({icon:"none",title:t})}this.toQuoteCopyItem=e(this.quotation),this.showQuotationPop=!0},supplierAgreeCustomerQuote(){for(var t="",o="",e=0;e<this.quotation.bargainingRecord.length;e++){const o=this.quotation.bargainingRecord[e];if(-1!=o.roleType.indexOf("我方")){t=o.priceScheme.freight;break}}for(e=0;e<this.quotation.bargainingRecord.length;e++){const t=this.quotation.bargainingRecord[e];if(-1!=t.roleType.indexOf("对方")){o=t.priceScheme.freight;break}}this.supplierAgreeHtml=`是否接受报价方案:<strong>【${this.quotation.code}】</strong> 报价金额为 <span style="color: #FF0003;font-weight: bold;">￥${t}</span> 调整为<span style="color: #FF0003; font-weight: bold;">￥${o}？</span>`,this.actionType=3,this.showModal=!0},stopQuote(){this.modalText="是否弃用该报价？",this.actionType=1,this.showModal=!0},agreeQuote(){this.modalText=`是否采用报价方案【${this.quotation.code}】`,this.actionType=2,this.showModal=!0},actionDetail(){a({url:"/pages/trade/quotationDetail?id="+item.quotation.id})},actionConfirm(){1==this.actionType?A(this.quotation.id).then((t=>{this.showModal=!1,o({title:"已弃用",icon:"success"}),this.needReload(),n("tradeGoodsDetail-refresh",{})})).catch((t=>{this.showModal=!1,o({title:t.data.msg?t.data.msg:"提交失败",icon:"none"})})):2==this.actionType?C(this.quotation.id).then((t=>{this.showModal=!1,o({title:"已采纳",icon:"success"}),this.needReload(),n("tradeGoodsDetail-refresh",{})})).catch((t=>{this.showModal=!1,o({title:t.data.msg?t.data.msg:"提交失败",icon:"none"})})):3==this.actionType&&S(this.quotation.nowQuote.id).then((t=>{this.showModal=!1,o({title:"已接受议价",icon:"success"}),this.needReload(),n("tradeGoodsDetail-refresh",{})})).catch((t=>{this.showModal=!1,o({title:t.data.msg?t.data.msg:"提交失败",icon:"none"})}))},quotationSuccess(){this.showQuotationPop=!1,this.needReload()},needReload(){this.$emit("reload")},goDetail(){a({url:"/pages/trade/quotationDetail?id="+this.quotation.id})}}},[["render",function(t,o,e,a,n,k){const A=_,C=Q,S=b,T=i(s("u-line"),l),I=i(s("u-modal"),c),M=u("tradeQuotationPrice");return r(),d(m,null,[h(A,{class:"t-q-plan-container u-p-b-20",onClick:k.goDetail},{default:f((()=>[h(A,{class:"t-q-plan-order"},{default:f((()=>[p(g(1==e.quotation.priceScheme.type?"单箱方案":"组合方案")+":"+g(e.quotation.code),1)])),_:1}),h(A,{style:{padding:"10rpx 26rpx 0 26rpx"}},{default:f((()=>[(r(!0),d(m,null,y(e.quotation.nowQuote.priceScheme.containerInfo,((t,o)=>(r(),x(A,{class:"u-m-t-10",key:o},{default:f((()=>[h(A,{style:{color:"#292a2b","font-weight":"500"}},{default:f((()=>[p(g(t.product),1)])),_:2},1024),h(A,{class:"u-flex u-flex-between u-flex-items-end"},{default:f((()=>[h(A,{class:"u-flex u-flex-items-center"},{default:f((()=>[h(C,{style:{color:"#666E81","font-size":"24rpx"}},{default:f((()=>[p("预计装载量:")])),_:1}),h(C,{style:{"margin-left":"4rpx",color:"#292A2B","font-size":"24rpx","font-weight":"500"}},{default:f((()=>[p(g(t.productWeight)+"吨",1)])),_:2},1024)])),_:2},1024),h(A,{style:{"z-index":"10"}},{default:f((()=>[h(C,{style:{"font-weight":"500","font-size":"30rpx"}},{default:f((()=>[p("￥")])),_:1}),h(C,{style:{color:"#292a2b","font-family":"DIN Alternate, DIN Alternate-Bold","font-size":"36rpx"}},{default:f((()=>[p(g(t.price),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128)),h(S,{class:"t-q-plan-status",src:e.quotation.statusIcon},null,8,["src"]),h(T,{class:"u-m-t-20",dashed:!0}),h(A,null,{default:f((()=>[h(A,{class:"u-flex u-flex-between u-m-t-20"},{default:f((()=>[h(C,{style:{color:"#666e81","font-size":"26rpx"}},{default:f((()=>[p("预计箱数量")])),_:1}),h(C,{style:{color:"#292A2B","font-size":"26rpx"}},{default:f((()=>[p(g(e.quotation.boxCountInfo),1)])),_:1})])),_:1}),h(A,{class:"u-flex u-flex-between u-m-t-20"},{default:f((()=>[h(C,{style:{color:"#666e81","font-size":"26rpx"}},{default:f((()=>[p("总折合吨价")])),_:1}),h(C,{style:{color:"#292A2B","font-size":"26rpx"}},{default:f((()=>[p(g(e.quotation.nowQuote.priceScheme.freight)+"元/"+g(e.quotation.nowQuote.priceScheme.priceUnit),1)])),_:1})])),_:1}),h(A,{class:"u-flex u-flex-between u-m-t-20"},{default:f((()=>[h(C,{style:{color:"#666e81","font-size":"26rpx"}},{default:f((()=>[p("最新报价时间")])),_:1}),h(C,{style:{color:"#292A2B","font-size":"26rpx"}},{default:f((()=>[p(g(e.quotation.nowQuote.createdate),1)])),_:1})])),_:1}),h(A,{class:"u-flex u-flex-between u-m-t-20"},{default:f((()=>[h(C,{style:{color:"#666e81","font-size":"26rpx"}},{default:f((()=>[p("合计总价")])),_:1}),h(C,{style:{color:"#292A2B","font-size":"30rpx","font-weight":"500"}},{default:f((()=>[p("￥"+g(e.quotation.nowQuote.priceScheme.totalPrice),1)])),_:1})])),_:1})])),_:1}),e.quotation.changeInfo?(r(),x(A,{key:0,style:{"margin-top":"20rpx",padding:"20rpx 10rpx",background:"#f4f4f4","border-radius":"4px"}},{default:f((()=>[(r(!0),d(m,null,y(e.quotation.changeInfo,((t,o)=>(r(),x(A,{key:o,innerHTML:t.htmlText,style:{"font-size":"24rpx",color:"#666E81"}},null,8,["innerHTML"])))),128))])),_:1})):q("",!0),e.canEdit&&!n.onlySeeSee&&e.quotation&&4!=e.quotation.checkStatus&&5!=t.checkStatus?(r(),x(A,{key:1,class:"u-m-t-20 u-flex u-flex-items-center u-flex-end"},{default:f((()=>[h(A,{style:{color:"#666E81"}},{default:f((()=>[p("详情")])),_:1}),h(A,{style:{flex:"1"}}),n.tool.canDisable?(r(),x(A,{key:0,class:"t-q-plan-btn t-q-plan-btn3",onClick:w(k.stopQuote,["stop"])},{default:f((()=>[p("弃用报价")])),_:1},8,["onClick"])):q("",!0),n.tool.canQuotation?(r(),x(A,{key:1,class:"t-q-plan-btn t-q-plan-btn1",onClick:w(k.toQuotation,["stop"])},{default:f((()=>[p("议价")])),_:1},8,["onClick"])):q("",!0),n.tool.canAgreeEnd?(r(),x(A,{key:2,class:"t-q-plan-btn t-q-plan-btn2",onClick:w(k.agreeQuote,["stop"])},{default:f((()=>[p("采用报价")])),_:1},8,["onClick"])):q("",!0),n.tool.canAgreeQutation?(r(),x(A,{key:3,class:"t-q-plan-btn t-q-plan-btn2",onClick:w(k.supplierAgreeCustomerQuote,["stop"])},{default:f((()=>[p("确认议价")])),_:1},8,["onClick"])):q("",!0),n.tool.canQuotationNext?(r(),x(A,{key:4,class:"t-q-plan-btn t-q-plan-btn2",style:{opacity:"0.5"}},{default:f((()=>[p("已报价")])),_:1})):q("",!0)])),_:1})):q("",!0)])),_:1})])),_:1},8,["onClick"]),h(I,{show:n.showModal,width:"640rpx",closeOnClickOverlay:!0,onConfirm:k.actionConfirm,onClose:k.closeModal,onCancel:k.closeModal,ref:"uModal",showCancelButton:!0,asyncClose:!0},{default:f((()=>[h(A,{style:{display:"flex","flex-direction":"column"}},{default:f((()=>[1==n.actionType?(r(),x(A,{key:0},{default:f((()=>[h(A,{style:{width:"100%","text-align":"center","font-size":"36rpx",color:"#292A2B","font-weight":"500"}},{default:f((()=>[p("弃用报价")])),_:1}),h(A,{style:{"font-weight":"500","margin-top":"30rpx",width:"100%",color:"#292A2B"}},{default:f((()=>[p(g(n.modalText),1)])),_:1})])),_:1})):2==n.actionType?(r(),x(A,{key:1},{default:f((()=>[h(A,{style:{width:"100%","text-align":"center","font-size":"36rpx",color:"#292A2B","font-weight":"500"}},{default:f((()=>[p("采用报价")])),_:1}),h(A,{style:{"font-weight":"500","margin-top":"30rpx",width:"100%",color:"#292A2B"}},{default:f((()=>[p(g(n.modalText),1)])),_:1})])),_:1})):3==n.actionType?(r(),x(A,{key:2},{default:f((()=>[h(A,{style:{width:"100%","text-align":"center","font-size":"36rpx",color:"#292A2B","font-weight":"500"}},{default:f((()=>[p("确认议价")])),_:1}),h(A,{style:{"font-weight":"500","margin-top":"30rpx",width:"100%",color:"#292A2B"},innerHTML:n.supplierAgreeHtml},null,8,["innerHTML"])])),_:1})):q("",!0),h(A,{class:"u-m-t-20"},{default:f((()=>[(r(!0),d(m,null,y(e.quotation.planInfo,((t,o)=>(r(),x(A,{class:"u-flex u-m-b-4",key:o},{default:f((()=>[h(C,{style:{color:"#666E81",width:"160rpx"}},{default:f((()=>[p(g(t.title),1)])),_:2},1024),h(C,{style:{color:"#292A2B"}},{default:f((()=>[p(g(t.value),1)])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1})])),_:1},8,["show","onConfirm","onClose","onCancel"]),h(M,{show:n.showQuotationPop,sourceData:e.sourceData,item:n.toQuoteCopyItem,closeOnClickOverlay:!0,onClose:o[0]||(o[0]=t=>n.showQuotationPop=!1),onSuccess:k.quotationSuccess},null,8,["show","sourceData","item","onSuccess"])],64)}],["__scopeId","data-v-e931edcf"]]);export{T as t};
