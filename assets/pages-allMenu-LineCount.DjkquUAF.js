import{_ as t,al as i,n as e,s as n,T as o,V as s,r as a,c as l,f as r,g as p,w as c,F as h,ac as d,q as u,a8 as f,d as g,o as m,ai as x,y as C,k as w,t as b,l as y,p as M,S as _,i as k}from"./index-oXtcu1jG.js";import{_ as z}from"./l-floating-panel.BJNvvv1R.js";import{g as S,b as A,c as F}from"./pythonApi.8vw1fDDo.js";import{g as B,a as L}from"./webApi.CoqPfbIF.js";import{A as j}from"./AmapUtil.CIrCVBrz.js";import"./constants.mpH2PV74.js";const E=t({data(){const{windowHeight:t}=i();return{windowHeight:t,anchors:[50,Math.round(.4*t),Math.round(.8*t)],map:null,listCount:[],list:[],listBorderStation:[],listCnStation:[],listCnLine:[]}},onLoad(t){this.getCount(),this.getBorderStation(),this.getCnStation(),this.getCnLine()},mounted(){j.createInstance()},methods:{search(t){if(0==t.length)return void(this.listCount=this.list);let i=[];for(let e of this.list)e.blpp.includes(t)&&i.push(e);this.listCount=i},check(t){e({url:"/pages/allMenu/LineDetail?line="+t})},initMap(){null==this.map&&(this.map=new AMap.Map("container",{viewMode:"2D"}))},getCount(){S().then((t=>{0!=t.length?(this.list=t,this.listCount=t):n({title:"班列信息为空",icon:"error"})}))},getBorderStation(){A().then((t=>{this.listBorderStation=t.data,this.listBorderStation.length>0&&setTimeout((()=>{this.initBorderPoints()}),200)}))},initBorderPoints(){this.initMap();for(let t of this.listBorderStation){let i=new AMap.Marker({map:this.map,position:[t.lon,t.lat],icon:new AMap.Icon({image:"/static/image/menu/icon_border_point.png",imageSize:new AMap.Size(15,15)}),zIndex:100});i.content=t.hzzm,i.on("click",this.addClick)}this.map.setFitView()},getCnStation(){B().then((t=>{this.listCnStation=t.features,this.listCnStation.length>0&&setTimeout((()=>{this.initCnPoints()}),200)}))},initCnPoints(){this.initMap();for(let t of this.listCnStation){let i=new AMap.Marker({map:this.map,position:t.geometry.coordinates,icon:new AMap.Icon({image:"/static/image/menu/icon_cn_point.png",imageSize:new AMap.Size(10,10)})});i.content=t.properties.name,i.on("click",this.addClick)}this.map.setFitView()},getCnLine(){L().then((t=>{this.listCnLine=t.features,this.listCnLine.length>0&&setTimeout((()=>{this.initCnLine()}),200)}))},initCnLine(){this.initMap();for(let t of this.listCnLine){let i=new AMap.Polyline({path:t.geometry.coordinates,strokeColor:`#${Math.floor(16777215*Math.random()).toString(16)}`,strokeWeight:1,strokeOpacity:1,lineCap:"round",zIndex:50});this.map.add(i)}this.map.setFitView()},addClick(t){o({title:"查询中"}),F(t.target.content).then((i=>{if("ok"==i.msg){var e=[];e.push(`<p style="font-size: 16px;color: #272E3F;font-weight: bold;">${i.info.label2}</p>`),e.push(`<p style="font-size: 12px;color: #666E81;margin-top: 5px;">位置：${i.info.city+i.info.qxmc}</p>`),e.push(`<p style="font-size: 12px;color: #666E81;margin-top: 5px;">路局：${i.info.ljqc}</p>`),e.push(`<p style="font-size: 12px;color: #2647FF;margin-top: 5px; @click='${void console.log("详情")}'">查看详情</p>`),new AMap.InfoWindow({content:e.join(""),anchor:"bottom-center"}).open(this.map,t.target.getPosition())}else n({title:"没有数据",icon:"error"})})).catch((t=>{n({title:"没有数据",icon:"error"})})).finally((t=>{s()}))}},onPageScroll(t){t.scrollTop>400?this.bgColor="white":this.bgColor="transparent"}},[["render",function(t,i,e,n,o,s){const S=a(l("u-navbar"),d),A=u,F=a(l("u-search"),f),B=M,L=a(l("u-icon"),g),j=_,E=a(l("l-floating-panel"),z);return m(),r(h,null,[p(A,{class:"u-flex-column"},{default:c((()=>[p(S,{borderBottom:!1,bgColor:"transparent",title:"班列统计"}),x("div",{id:"container",class:"map",style:C([{width:"100%"},"height:"+o.windowHeight+"px"])},null,4)])),_:1}),p(E,{anchors:o.anchors,defaultAnchor:1},{default:c((()=>[p(A,{class:"u-flex-column",style:{padding:"30rpx"}},{default:c((()=>[p(F,{showAction:!1,placeholder:"请输入班列名称进行查询",onChange:s.search},null,8,["onChange"]),p(B,{style:{"font-size":"28rpx",color:"#272E3F","margin-top":"30rpx","font-weight":"bold"}},{default:c((()=>[w(" 班列统计 ")])),_:1}),p(A,{class:"u-flex u-m-t-20"},{default:c((()=>[p(B,{style:{"font-size":"24rpx",color:"#292A2B"}},{default:c((()=>[w(" 国内 ")])),_:1}),p(B,{style:{"font-size":"24rpx",color:"#FAAD14","margin-left":"10rpx"}},{default:c((()=>[w(b(o.list.length),1)])),_:1})])),_:1}),p(j,{"scroll-y":"",style:C([{"margin-top":"20rpx"},"height:"+(o.anchors[2]-180)+"px"])},{default:c((()=>[(m(!0),r(h,null,y(o.listCount,((t,i)=>(m(),k(A,{key:i,class:"u-flex u-flex-between u-flex-items-center",style:{background:"#f8f9fd","border-radius":"8px",padding:"32rpx 24rpx","margin-top":"20rpx"}},{default:c((()=>[p(L,{style:{flex:"1"},name:"/static/image/share/icon_station_blue.png",size:"18",label:i+1+"."+t.blpp,"label-color":"#272E3F","label-size":"13",space:"10"},null,8,["label"]),p(A,{class:"u-flex u-m-l-20 u-m-r-40"},{default:c((()=>[p(B,{style:{"font-size":"28rpx",color:"#666E81"}},{default:c((()=>[w(" 通道数量： ")])),_:1}),p(B,{style:{"font-size":"28rpx",color:"#2647FF"}},{default:c((()=>[w(b(t.count),1)])),_:2},1024)])),_:2},1024),p(B,{style:{background:"white",border:"0.5px solid #2647ff","border-radius":"4px","font-size":"24rpx",color:"#2647FF",padding:"12rpx 24rpx"},onClick:i=>s.check(t.blpp)},{default:c((()=>[w(" 查看 ")])),_:2},1032,["onClick"])])),_:2},1024)))),128))])),_:1},8,["style"])])),_:1})])),_:1},8,["anchors"])],64)}]]);export{E as default};
