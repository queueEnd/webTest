import{_ as t,n as e,s as a,aR as i,r as o,c as s,A as l,f as n,g as r,w as c,F as d,a_ as u,d as m,bw as h,o as f,i as p,k as g,t as _,y as D,j as y,l as x,p as w,q as k,m as b}from"./index-FwbBwjbJ.js";import{_ as T}from"./uv-skeletons.X_8W0G2D.js";import{_ as S}from"./z-paging.B7jAqyNm.js";import{t as A}from"./trade-quotation-list.B9W9sUVw.js";import{t as Q}from"./trade-quote-price._VszDH1B.js";import{w as q,b as C,t as M,u as I,v}from"./zhdnTradeApi.D1sQ_EGE.js";import{o as L}from"./zhtuseful.CyewbK9i.js";import{T as B}from"./tradeConfig.Csb849zU.js";import{_ as E}from"./goods_detail.DaJ6WKyR.js";/* empty css                                                                             */import"./icon-minuso.B2DiVMTc.js";const R=t({components:{tradeQuotationList:A,tradeQuotationPrice:Q},data:()=>({id:null,goodsId:null,isEnd:null,loading:!1,skeleton:L.detailSkeleton,timeData:{},sourceData:null,itemData:null,tool:{canAgreeQutation:!1,canQuotation:!1,canDisable:!1,canAgreeEnd:!1,canQuotationNext:!1},statusColor:"#333333",statusText:"-",statusBorderClass:{},showQuotationPop:!1,quotationLimitTime:0,showModal:!1,actionType:0,supplierAgreeHtml:"",modalText:"",currentQuotePlan:null}),onLoad(t){t.isEnd&&(this.isEnd=t.isEnd),t.goodsId?(this.goodsId=t.goodsId,this.loadSourceData()):t.id&&(this.id=t.id,this.loadDetailData())},watch:{sourceData:{handler(){if(this.sourceData){if(1==this.sourceData.isValid||2==this.sourceData.isValid){const t=new Date(this.sourceData.estimatedShippingTime);if(!isNaN(t.getTime())){const e=Date.now(),a=new Date(t).getTime(),i=Math.floor(a-e);this.quotationLimitTime=i}}if(this.isEnd){const e=this.sourceData.sendPriceList;for(var t=0;t<e.length;t++){const a=e[t];if(4==a.checkStatus){this.itemData=a;break}}}}},immediate:!0},itemData:{handler(){if(this.itemData){const t=this.itemData.checkStatus;let e="",a="#666666",i="";switch(t){case 1:e="待报价",i="正在竞价中",a="#FAAD14";break;case 4:e="已采用",i="竞价完成",a="#00CB40";break;case 5:e="已弃用",i="竞价完成",a="#FF0003";break;default:e="进行中",i="正在竞价中",a="#FAAD14"}if(this.itemData.checkStatusText=e,this.itemData.quotationStatusText=i,this.itemData.checkStatusColor=a,this.itemData.newestItem=this.itemData.bargainingRecord[0],this.itemData.isSendPriceBySelf)if(4==t||5==t)this.resetTool();else{if(this.itemData.bargainingRecord.length>0){-1!=this.itemData.bargainingRecord[0].roleType.indexOf("我方")?(this.tool.canAgreeQutation=!1,this.tool.canQuotation=!1,this.tool.canDisable=!1,this.tool.canAgreeEnd=!1,this.tool.canQuotationNext=!0):(this.tool.canAgreeQutation=!0,this.tool.canQuotation=!0,this.tool.canDisable=!1,this.tool.canAgreeEnd=!1,this.tool.canQuotationNext=!1)}}else if(4==t||5==t)this.resetTool();else{if(this.itemData.bargainingRecord.length>0){-1!=this.itemData.bargainingRecord[0].roleType.indexOf("我方")?(this.tool.canAgreeQutation=!1,this.tool.canQuotation=!1,this.tool.canDisable=!0,this.tool.canAgreeEnd=!1,this.tool.canQuotationNext=!0):(this.tool.canAgreeQutation=!1,this.tool.canQuotation=!0,this.tool.canDisable=!0,this.tool.canAgreeEnd=!0,this.tool.canQuotationNext=!1)}}this.itemData.transportModeTypeStr="-",B.forEach((t=>{t.id==this.itemData.transportModeType&&(this.itemData.transportModeTypeStr=t.name)})),this.simplyQuoteModelInfo();this.itemData.bargainingRecord.reduce(((t,e)=>{const a=new Date(e.createdate),i=`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}-${String(a.getDate()).padStart(2,"0")}`;return t[i]||(t[i]={date:i,items:[]}),t[i].items.push(e),t}),{})}else this.resetTool()},immediate:!0}},methods:{limitTimeChange(t){this.timeData=t},loadDetailData(){this.id&&(this.loading=!0,q(this.id).then((t=>{this.itemData=t.data,this.loadSourceData()})).catch((t=>{this.loading=!1})))},loadSourceData(){(this.goodsId||this.itemData.resourceId)&&(this.loading=!0,C(this.itemData?this.itemData.resourceId:this.goodsId).then((t=>{this.loading=!1,this.sourceData=t.data,this.$refs.paging.complete()})).catch((t=>{this.loading=!1,this.$refs.paging.complete()})))},resetTool(){this.tool.canAgreeQutation=!1,this.tool.canQuotation=!1,this.tool.canDisable=!1,this.tool.canAgreeEnd=!1,this.tool.canQuotationNext=!1},goSourceDetail(){e({url:"/pages/trade/goodsDetail?id="+this.sourceData.id})},toQuotation(){if(!this.tool.canQuotation){let t="暂时不能报价";return t=4==this.itemData.checkStatus||5==this.itemData.checkStatus?"报价已结束，不能继续议价":"已提交报价，等待对方确认",void a({icon:"none",title:t})}this.showQuotationPop=!0},closeModal(){this.showModal=!1},actionConfirm(){1==this.actionType?M(this.itemData.id).then((t=>{this.showModal=!1,a({title:"已弃用",icon:"success"}),this.loadDetailData(),i("tradeGoodsDetail-refresh",{})})).catch((t=>{this.showModal=!1,a({title:t.data.msg?t.data.msg:"提交失败",icon:"none"})})):2==this.actionType?I(this.itemData.id).then((t=>{this.showModal=!1,a({title:"已采纳",icon:"success"}),this.loadDetailData(),i("tradeGoodsDetail-refresh",{})})).catch((t=>{this.showModal=!1,a({title:t.data.msg?t.data.msg:"提交失败",icon:"none"})})):3==this.actionType&&v(this.itemData.id).then((t=>{this.showModal=!1,a({title:"已接受议价",icon:"success"}),this.loadDetailData(),i("tradeGoodsDetail-refresh",{})})).catch((t=>{this.showModal=!1,a({title:t.data.msg?t.data.msg:"提交失败",icon:"none"})}))},supplierAgreeCustomerQuote(){for(var t="",e="",a=0;a<this.itemData.bargainingRecord.length;a++){const e=this.itemData.bargainingRecord[a];if(-1!=e.roleType.indexOf("我方")){t=e.price;break}}for(a=0;a<this.itemData.bargainingRecord.length;a++){const t=this.itemData.bargainingRecord[a];if(-1!=t.roleType.indexOf("对方")){e=t.price;break}}const i=this.sourceData.addressList[0];this.supplierAgreeHtml=`是否接收<strong>【${i.startAddress}】</strong> –<strong>【${i.endAddress}】</strong>报价金额为 <span style="color: #FF0003;font-weight: bold;">￥${t}</span> 调整为<br/><span style="color: #FF0003; font-weight: bold;">￥${e}？</span>`,this.actionType=3,this.showModal=!0},stopQuote(){this.sourceData.addressList[0],this.modalText="是否弃用该报价？",this.actionType=1,this.showModal=!0},agreeQuote(){const t=this.sourceData.addressList[0];this.modalText=`是否采用【${t.startAddress}】-【${t.endAddress}】`,this.actionType=2,this.showModal=!0},simplyQuoteModelInfo(){const t=[],e=this.itemData.newestItem.priceScheme;let a="";e.containerInfo.forEach((t=>{a.length>0&&(a+="\n"),a+=`${t.product}*${t.productNum} 预计装载量 ${t.productWeight}吨`})),t.push({title:"装载方案:",value:a}),t.push({title:"折合单价:",value:e.freight+"元/"+e.priceUnit}),t.push({title:"合计总价:",value:"￥"+e.totalPrice}),this.itemData.planInfo=t},quotationSuccess(){this.showQuotationPop=!1,this.loadDetailData()}}},[["render",function(t,e,a,i,A,Q){const q=w,C=k,M=o(s("u-empty"),u),I=b,v=o(s("u-icon"),m),L=l("up-count-down"),B=l("tradeQuotationList"),R=o(s("uv-skeletons"),T),F=o(s("z-paging"),S),j=l("tradeQuotationPrice"),z=o(s("u-modal"),h);return f(),n(d,null,[r(F,{ref:"paging","refresher-only":"",onOnRefresh:t.onRefresh,style:{"background-color":"#F0F2F7"}},{bottom:c((()=>[4==A.itemData.checkStatus&&A.sourceData.isCreateBySelf?(f(),p(C,{key:0,class:"quotationDetail-bottom"},{default:c((()=>[r(C,{style:{display:"flex","flex-direction":"column"}},{default:c((()=>[r(C,{style:{"font-size":"20rpx",color:"#666E81"}},{default:c((()=>[g("报价金额")])),_:1}),r(C,{class:"qp-one-price"},{default:c((()=>[r(q,{class:"rd-one-price__value",style:{color:"#292A2B","margin-left":"0"}},{default:c((()=>[g(_(A.itemData.newestItem.priceScheme.freight),1)])),_:1}),r(q,{class:"quo-detail-item-title u-m-l-6",style:{color:"#292A2B"}},{default:c((()=>[g("元/"+_(A.itemData.newestItem.priceScheme.priceUnit),1)])),_:1})])),_:1})])),_:1}),r(C,{style:{flex:"1"}}),r(C,{class:"quotationDetail-bottom__btnNormal u-m-l-20"},{default:c((()=>[g("前往下单")])),_:1})])),_:1})):4!=A.itemData.checkStatus?(f(),p(C,{key:1,class:"quotationDetail-bottom"},{default:c((()=>[r(C,{style:{display:"flex","flex-direction":"column"}},{default:c((()=>[r(C,{style:{"font-size":"20rpx",color:"#666E81"}},{default:c((()=>[g("当前报价金额")])),_:1}),r(C,{class:"rd-one-price"},{default:c((()=>[r(q,{class:"rd-one-price__value",style:{color:"#292A2B","margin-left":"0"}},{default:c((()=>[g(_(A.itemData.newestItem.priceScheme.freight),1)])),_:1}),r(q,{class:"quo-detail-item-title u-m-l-6",style:{color:"#292A2B"}},{default:c((()=>[g("元/"+_(A.itemData.newestItem.priceScheme.priceUnit),1)])),_:1})])),_:1})])),_:1}),r(C,{style:{flex:"1"}}),A.itemData&&4!=A.itemData.checkStatus&&5!=A.itemData.checkStatus?(f(),p(C,{key:0,class:"u-flex"},{default:c((()=>[r(C,{class:"u-p-t-6 u-p-r-16",style:D({opacity:A.tool.canQuotation?1:.5}),onClick:Q.toQuotation},{default:c((()=>[r(v,{label:"议价","label-pos":"bottom","label-size":"20rpx",name:"/static/image/trade/quotation_again.png",size:"36rpx",color:"#292A2B","label-color":"#292A2B"})])),_:1},8,["style","onClick"]),A.tool.canAgreeQutation?(f(),p(C,{key:0,class:"quotationDetail-bottom__agree u-m-l-20",onClick:Q.supplierAgreeCustomerQuote},{default:c((()=>[g("确认议价")])),_:1},8,["onClick"])):y("",!0),A.tool.canDisable?(f(),p(C,{key:1,class:"quotationDetail-bottom__disable u-m-l-20",onClick:Q.stopQuote},{default:c((()=>[g("弃用 ")])),_:1},8,["onClick"])):y("",!0),A.tool.canAgreeEnd?(f(),p(C,{key:2,class:"quotationDetail-bottom__agreeEnd u-m-l-20",onClick:Q.agreeQuote},{default:c((()=>[g(" 采用")])),_:1},8,["onClick"])):y("",!0),A.tool.canQuotationNext?(f(),p(C,{key:3,class:"quotationDetail-bottom__agreeEnd u-m-l-20",style:{opacity:"0.5",color:"#fff"}},{default:c((()=>[g(" 已报价")])),_:1})):y("",!0)])),_:1})):y("",!0)])),_:1})):y("",!0)])),default:c((()=>[r(R,{skeleton:A.skeleton,animate:!0,loading:A.loading},{default:c((()=>[A.loading||A.itemData?(f(),p(C,{key:1},{default:c((()=>[r(C,{class:"rd-section-bg"},{default:c((()=>[r(I,{class:"rd-one-logo",src:E}),r(C,{class:"rd-one-top"},{default:c((()=>[r(C,{class:"rd-one-top__title"},{default:c((()=>[g("意向价格/"+_(A.sourceData.goodWeightUnit),1)])),_:1}),r(C,{class:"rd-one-top__status",style:D({backgroundColor:A.itemData.checkStatusColor})},{default:c((()=>[g(_(A.itemData.checkStatusText),1)])),_:1},8,["style"])])),_:1}),r(C,{style:{display:"flex","justify-content":"space-between"}},{default:c((()=>[r(C,{class:"rd-one-price"},{default:c((()=>[r(q,{class:"rd-one-price__unit"},{default:c((()=>[g("¥")])),_:1}),r(q,{class:"rd-one-price__value"},{default:c((()=>[g(_(A.sourceData.intentionPrice),1)])),_:1})])),_:1}),r(C,{class:"u-m-t-20 u-flex u-flex-items-center",style:{"font-size":"24rpx",border:"0.5px solid #2647ff","border-radius":"4px","background-color":"#edf2ff",height:"40rpx",padding:"0 12rpx",color:"#2647FF"}},{default:c((()=>[r(v,{name:"chat",size:"36rpx",color:"#2647FF"}),g(" "+_(A.itemData.quotationStatusText),1)])),_:1})])),_:1}),r(C,{class:"rd-one-tiem"},{default:c((()=>[r(C,{class:"rd-one-tiem__title"},{default:c((()=>[g(_(0==A.quotationLimitTime?"报价已结束":"距报价结束"),1)])),_:1}),A.quotationLimitTime>0?(f(),p(L,{key:0,time:A.quotationLimitTime,format:"HH:mm:ss",autoStart:"",millisecond:"",onChange:Q.limitTimeChange},{default:c((()=>[r(C,{class:"tradeLimit-p"},{default:c((()=>[A.timeData.days&&A.timeData.days>0?(f(),p(C,{key:0,class:"tradeLimit-p_day"},{default:c((()=>[g(_(A.timeData.days),1)])),_:1})):y("",!0),A.timeData.days&&A.timeData.days>0?(f(),p(q,{key:1,class:"tradeLimit-p_dayunit"},{default:c((()=>[g("天")])),_:1})):y("",!0),r(C,{class:"tradeLimit-p_item"},{default:c((()=>[g(_(A.timeData.hours>10?A.timeData.hours:"0"+A.timeData.hours),1)])),_:1}),r(q,{class:"tradeLimit-p_doc"},{default:c((()=>[g(":")])),_:1}),r(C,{class:"tradeLimit-p_item"},{default:c((()=>[g(_(String(A.timeData.minutes).padStart(2,"0")),1)])),_:1}),r(q,{class:"tradeLimit-p_doc"},{default:c((()=>[g(":")])),_:1}),r(C,{class:"tradeLimit-p_item"},{default:c((()=>[g(_(String(A.timeData.seconds).padStart(2,"0")),1)])),_:1})])),_:1})])),_:1},8,["time","onChange"])):y("",!0)])),_:1})])),_:1}),r(C,{class:"rd-section-bg u-flex u-flex-between",onClick:Q.goSourceDetail},{default:c((()=>[r(C,{class:"rd-section-title"},{default:c((()=>[g("货源信息")])),_:1}),r(C,{class:"u-flex"},{default:c((()=>[r(C,{style:{color:"#2647ff"}},{default:c((()=>[g("查看货源详情")])),_:1}),r(v,{class:"u-m-l-20",name:"arrow-right",color:"#2647ff"})])),_:1})])),_:1},8,["onClick"]),A.itemData&&A.itemData.bargainingRecord.length>0?(f(),p(C,{key:0,class:"rd-section-bg"},{default:c((()=>[r(C,{class:"rd-section-title"},{default:c((()=>[g("报价信息")])),_:1}),r(C,{class:"quo-detail-item"},{default:c((()=>[r(q,{class:"quo-detail-item-title"},{default:c((()=>[g("报价企业")])),_:1}),r(q,{class:"quo-detail-item-value"},{default:c((()=>[g(_(A.itemData.transportModeTypeStr),1)])),_:1})])),_:1}),r(C,{class:"quo-detail-item"},{default:c((()=>[r(q,{class:"quo-detail-item-title"},{default:c((()=>[g("运输方式")])),_:1}),r(q,{class:"quo-detail-item-value"},{default:c((()=>[g(_(A.itemData.parentTenantName),1)])),_:1})])),_:1}),r(C,{class:"quo-detail-item"},{default:c((()=>[r(q,{class:"quo-detail-item-title"},{default:c((()=>[g("票类/税率")])),_:1}),r(q,{class:"quo-detail-item-value"},{default:c((()=>[g(_(A.itemData.newestItem.freightTicketCategory)+" "+_(A.itemData.freightTaxRate),1)])),_:1})])),_:1}),r(C,{class:"quo-detail-item"},{default:c((()=>[r(q,{class:"quo-detail-item-title"},{default:c((()=>[g("币种")])),_:1}),r(q,{class:"quo-detail-item-value"},{default:c((()=>[g(_(A.itemData.newestItem.currency),1)])),_:1})])),_:1}),r(C,{class:"quo-detail-item"},{default:c((()=>[r(q,{class:"quo-detail-item-title"},{default:c((()=>[g("最新报价时间")])),_:1}),r(q,{class:"quo-detail-item-value"},{default:c((()=>[g(_(A.itemData.newestItem.createdate),1)])),_:1})])),_:1}),r(C,{style:{display:"flex","justify-content":"flex-end","align-items":"flex-end"}},{default:c((()=>[r(q,{class:"quo-detail-item-title"},{default:c((()=>[g(_(4!=A.itemData.checkStatus?"当前报价金额:":"最终报价金额:"),1)])),_:1}),r(C,{class:"rd-one-price u-m-l-20"},{default:c((()=>[r(q,{class:"rd-one-price__value",style:{color:"#292A2B"}},{default:c((()=>[g(_(A.itemData.newestItem.priceScheme.freight),1)])),_:1}),r(q,{class:"quo-detail-item-title u-m-l-6",style:{color:"#292A2B"}},{default:c((()=>[g("元/"+_(A.itemData.newestItem.priceScheme.priceUnit),1)])),_:1})])),_:1})])),_:1})])),_:1})):y("",!0),r(C,{class:"rd-section-bg u-m-b-60"},{default:c((()=>[r(C,{class:"rd-section-title"},{default:c((()=>[g("最新议价记录")])),_:1}),r(B,{timelineData:A.itemData.bargainingRecord},null,8,["timelineData"])])),_:1})])),_:1})):(f(),p(M,{key:0,show:0==t.dataList.length&&!A.loading,icon:"/static/image/common/empty.png",width:"200rpx",height:"200rpx",text:" "},{default:c((()=>[r(C,{style:{display:"flex","flex-direction":"column","align-items":"center"}},{default:c((()=>[r(q,{style:{color:"#272e3f"}},{default:c((()=>[g("暂无相关数据")])),_:1}),r(q,{style:{color:"#999999","margin-top":"10rpx","font-size":"24rpx"}})])),_:1})])),_:1},8,["show"]))])),_:1},8,["skeleton","loading"])])),_:1},8,["onOnRefresh"]),r(j,{show:A.showQuotationPop,sourceData:A.sourceData,item:A.itemData,closeOnClickOverlay:!0,onClose:e[0]||(e[0]=t=>A.showQuotationPop=!1),onSuccess:Q.quotationSuccess},null,8,["show","sourceData","item","onSuccess"]),r(z,{show:A.showModal,width:"640rpx",closeOnClickOverlay:!0,onConfirm:Q.actionConfirm,onClose:Q.closeModal,onCancel:Q.closeModal,ref:"uModal",showCancelButton:!0,asyncClose:!0},{default:c((()=>[r(C,{style:{display:"flex","flex-direction":"column"}},{default:c((()=>[1==A.actionType?(f(),p(C,{key:0},{default:c((()=>[r(C,{style:{width:"100%","text-align":"center","font-size":"36rpx",color:"#292A2B","font-weight":"500"}},{default:c((()=>[g("弃用报价 ")])),_:1}),r(C,{style:{"font-weight":"500","margin-top":"30rpx",width:"100%",color:"#292A2B"}},{default:c((()=>[g(_(A.modalText),1)])),_:1})])),_:1})):2==A.actionType?(f(),p(C,{key:1},{default:c((()=>[r(C,{style:{width:"100%","text-align":"center","font-size":"36rpx",color:"#292A2B","font-weight":"500"}},{default:c((()=>[g("采用报价 ")])),_:1}),r(C,{style:{"font-weight":"500","margin-top":"30rpx",width:"100%",color:"#292A2B"}},{default:c((()=>[g(_(A.modalText),1)])),_:1})])),_:1})):3==A.actionType?(f(),p(C,{key:2},{default:c((()=>[r(C,{style:{width:"100%","text-align":"center","font-size":"36rpx",color:"#292A2B","font-weight":"500"}},{default:c((()=>[g("确认议价 ")])),_:1}),r(C,{style:{"font-weight":"500","margin-top":"30rpx",width:"100%",color:"#292A2B"},innerHTML:A.supplierAgreeHtml},null,8,["innerHTML"])])),_:1})):y("",!0),r(C,{class:"u-m-t-20"},{default:c((()=>[(f(!0),n(d,null,x(A.itemData.planInfo,((t,e)=>(f(),p(C,{class:"u-flex u-m-b-4",key:e},{default:c((()=>[r(q,{style:{color:"#666E81",width:"160rpx"}},{default:c((()=>[g(_(t.title),1)])),_:2},1024),r(q,{style:{color:"#292A2B"}},{default:c((()=>[g(_(t.value),1)])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1})])),_:1},8,["show","onConfirm","onClose","onCancel"])],64)}],["__scopeId","data-v-fd6afbd7"]]);export{R as default};
