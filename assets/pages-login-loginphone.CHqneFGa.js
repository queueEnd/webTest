import{_ as e,Q as t,s as n,R as s,T as o,U as a,X as i,Y as c,Z as l,r as h,c as d,i as r,w as u,H as p,d as m,q as f,a0 as g,a1 as x,o as y,g as _,k as S,t as C}from"./index-B3fvMXoi.js";const k=e({data:()=>({captcha:"",phone:null,smsKey:null,canSend:!1,codeText:"",limitSeconds:120}),onLoad(e){const t=this.getOpenerEventChannel();let n=this;t.on("smsInfo",(function(e){n.configSMSData(e)}))},methods:{goBack(){t()},configSMSData(e){const t=JSON.parse(e.data);this.phone=t.phone,this.smsKey=t.smsKey,this.phone&&this.smsKey?this.$refs.uCode.start():this.canSend=!1},finish(e){this.captcha=e,this.phone&&this.smsKey?this.apiToLogin():n({title:"未获取到手机号",icon:"none"})},codeChange(e){this.codeText=e},codeEnd(){this.canSend=!0},getSMSCode(){this.phone?(s({title:"正在发送...",mask:!0}),o(this.phone).then((e=>{e.data.code&&(a(),n({icon:"none",title:"验证码已发送"}),this.canSend=!1,this.$refs.uCode.start(),this.smsKey=e.data.code)})).catch((e=>{a(),n({icon:"error",title:"发送失败"})}))):n({title:"未获取到手机号",icon:"none"})},apiToLogin(){if(0==this.smsKey.length)return void n({title:"请输入验证码",icon:"none"});const e={phone:this.phone,code:this.captcha,grant_type:"phone_sms_smart",scope:"all"};s({title:"正在登录...",mask:!0}),i(e,this.smsKey).then((e=>{e.tenantInfoList.length>1?this.switchTenant(e):(store.commit("login",e),a(),n({icon:"none",title:"登录成功"}),c({url:"/pages/index/index"}))})).catch((e=>{a(),n({icon:"error",title:"登录失败"})}))},switchTenant(e){const t=e.tenantInfoList[1].tenantId,s=e.refresh_token;l(t,s).then((e=>{store.commit("login",e),a(),n({icon:"none",title:"登录成功"}),c({url:"/pages/index/index"})})).catch((e=>{a(),n({icon:"error",title:"登录失败"})}))}}},[["render",function(e,t,n,s,o,a){const i=h(d("u-status-bar"),p),c=h(d("u-icon"),m),l=f,k=h(d("u-code-input"),g),T=h(d("u-code"),x);return y(),r(l,null,{default:u((()=>[_(l,null,{default:u((()=>[_(i),_(l,{class:"u-flex-y-center u-p-l-30",style:{width:"200rpx",height:"100rpx"},onClick:a.goBack},{default:u((()=>[_(c,{name:"close",color:"#292A2B",size:"20"})])),_:1},8,["onClick"])])),_:1}),_(l,{class:"u-m-t-30 u-margin-center-auto",style:{width:"600rpx"}},{default:u((()=>[_(l,{class:"l-title"},{default:u((()=>[S("输入验证码")])),_:1}),_(l,{class:"u-m-t-12",style:{color:"#666e81","font-size":"24rpx"}},{default:u((()=>[S("短信已发送至+86131****8888")])),_:1}),_(k,{class:"u-m-t-80",modelValue:o.captcha,"onUpdate:modelValue":t[0]||(t[0]=e=>o.captcha=e),hairline:"",mode:"line",maxlength:6,fontSize:"42rpx",color:"#333333",focus:!0,onFinish:a.finish},null,8,["modelValue","onFinish"]),_(l,{class:"u-m-t-40",style:{"font-size":"24rpx",color:"#666E81"}},{default:u((()=>[_(T,{ref:"uCode",seconds:o.limitSeconds,changeText:"Xs 后可重新获取",onChange:a.codeChange,onEnd:a.codeEnd},null,8,["seconds","onChange","onEnd"]),o.canSend?(y(),r(l,{key:0,style:{color:"#2647FF"}},{default:u((()=>[S("重发短信验证码")])),_:1})):(y(),r(l,{key:1},{default:u((()=>[S(C(o.codeText),1)])),_:1}))])),_:1})])),_:1})])),_:1})}],["__scopeId","data-v-a12a9dfc"]]);export{k as default};
