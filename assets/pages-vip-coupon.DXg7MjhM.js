import{_ as e,bT as t,b_ as s,b$ as o,Q as a,R as l,c0 as n,U as i,r as u,c as p,i as r,w as c,aZ as d,o as f,g,k as h,t as m,f as y,l as x,F as _,p as b,q as k,h as z}from"./index-B3fvMXoi.js";import{_ as C}from"./uv-skeletons.B5flGH1a.js";import{_ as F}from"./z-paging.Ctbk3ePi.js";import{o as $}from"./zhtuseful.CyewbK9i.js";const I=e({props:{type:{type:Number,default:0},cType:{type:Number,default:-1},cUsage:{type:Number,default:-1},cId:{type:String,default:null},gId:{type:String,default:null},price:{type:String,default:null}},data:()=>({loading:!1,skeleton:$.listSkeleton,list:[]}),onLoad(){this.onRefresh()},methods:{onRefresh(){this.loading=!0,0==this.type?this.gId?t({packageId:this.gId}).then((e=>{this.loading=!1,e.data.forEach((e=>{e.canUse=!0})),this.list=data,this.$refs.paging.complete()})).catch((e=>{this.loading=!1,this.$refs.paging.complete()})):s().then((e=>{this.loading=!1,this.matchCoupon(e.data),this.$refs.paging.complete()})).catch((e=>{this.loading=!1,this.$refs.paging.complete()})):o().then((e=>{this.loading=!1,this.list=e.data,this.$refs.paging.complete()})).catch((e=>{this.loading=!1,this.$refs.paging.complete()}))},matchCoupon(e){this.gId&&e.forEach((e=>{this.gId==e.coupon.memberPackageId||this.cType==e.coupon.type&&this.cUsage==e.coupon.usage&&Number(e.coupon.discount)<Number(this.price)?e.canUse=!0:e.canUse=!1})),this.list=e},useCoupon(e){if(1==e.status){this.getOpenerEventChannel().emit("useCoupon",e),a()}},getCoupon(e){l({title:"正在领取...",mask:!0}),n(e.id).then((e=>{i(),uni.$u.toast("已领取"),this.$refs.paging.reload()})).catch((e=>{i(),e.data&&e.data.msg?uni.$u.toast(e.data.msg):uni.$u.toast("领取失败"),this.$refs.paging.reload()}))}}},[["render",function(e,t,s,o,a,l){const n=b,i=k,$=u(p("u-empty"),d),I=u(p("uv-skeletons"),C),w=u(p("z-paging"),F);return f(),r(w,{ref:"paging","refresher-only":"",onOnRefresh:l.onRefresh,style:{"background-color":"#F0F2F7"}},{default:c((()=>[g(I,{animate:!0,loading:a.loading,skeleton:a.skeleton},{default:c((()=>[g($,{style:{"margin-top":"200rpx"},show:!a.loading&&0==a.list.length,icon:"/static/image/common/empty.png",width:"200rpx",height:"200rpx",text:" "},{default:c((()=>[g(i,{style:{display:"flex","flex-direction":"column","align-items":"center"}},{default:c((()=>[g(n,{style:{color:"#666E81"}},{default:c((()=>[h(m(1==s.type?"暂无可领取的优惠券":"暂无相关数据"),1)])),_:1}),g(n,{style:{color:"#999999","margin-top":"10rpx","font-size":"24rpx"}})])),_:1})])),_:1},8,["show"]),0==s.type?(f(),r(i,{key:0},{default:c((()=>[(f(!0),y(_,null,x(a.list,((e,t)=>(f(),r(i,{key:t,class:"bg_coupon u-flex u-flex-items-center",style:{margin:"20rpx 30rpx 0",padding:"0 20rpx",position:"relative"}},{default:c((()=>[g(i,{class:"u-flex u-flex-items-baseline"},{default:c((()=>[g(n,{style:{"font-size":"28rpx",color:"#FF0003"}},{default:c((()=>[h(" ￥ ")])),_:1}),g(n,{style:{"font-size":"44rpx",color:"#FF0003","font-weight":"bold"}},{default:c((()=>[h(m(Number(e.coupon.discount)),1)])),_:2},1024)])),_:2},1024),g(i,{class:"u-flex-column",style:{position:"absolute",left:"92px"}},{default:c((()=>[g(n,{style:{"font-size":"28rpx",color:"#292A2B","font-weight":"500"}},{default:c((()=>[h(m(e.coupon.name),1)])),_:2},1024),g(n,{style:{"font-size":"20rpx",color:"#666E81","margin-top":"28rpx"}},{default:c((()=>[h(" 有效期至："+m(e.coupon.endTime),1)])),_:2},1024)])),_:2},1024),e.canUse?(f(),r(n,{key:0,class:z(["coupon-btn",1==e.status?"":"coupon-btn-done"]),onClick:t=>l.useCoupon(e)},{default:c((()=>[h(m(1==e.status?"去使用":2==e.status?"已使用":"已过期"),1)])),_:2},1032,["class","onClick"])):(f(),r(n,{key:1,class:z(["coupon-btn",e.canUse?"":"coupon-btn-done"])},{default:c((()=>[h("不可用")])),_:2},1032,["class"]))])),_:2},1024)))),128))])),_:1})):(f(),r(i,{key:1},{default:c((()=>[(f(!0),y(_,null,x(a.list,((e,t)=>(f(),r(i,{key:t,class:"bg_coupon u-flex u-flex-items-center",style:{margin:"20rpx 30rpx 0",padding:"0 20rpx",position:"relative"}},{default:c((()=>[g(i,{class:"u-flex u-flex-items-baseline"},{default:c((()=>[g(n,{style:{"font-size":"28rpx",color:"#FF0003"}},{default:c((()=>[h(" ￥ ")])),_:1}),g(n,{style:{"font-size":"44rpx",color:"#FF0003","font-weight":"bold"}},{default:c((()=>[h(m(Number(e.discount)),1)])),_:2},1024)])),_:2},1024),g(i,{class:"u-flex-column",style:{position:"absolute",left:"92px"}},{default:c((()=>[g(n,{style:{"font-size":"28rpx",color:"#292A2B","font-weight":"500"}},{default:c((()=>[h(m(e.name),1)])),_:2},1024),g(n,{style:{"font-size":"20rpx",color:"#666E81","margin-top":"28rpx"}},{default:c((()=>[h(" 有效期至："+m(e.endTime),1)])),_:2},1024)])),_:2},1024),g(n,{class:"coupon-btn",onClick:t=>l.getCoupon(e)},{default:c((()=>[h(" 领取 ")])),_:2},1032,["onClick"])])),_:2},1024)))),128))])),_:1}))])),_:1},8,["loading","skeleton"])])),_:1},8,["onOnRefresh"])}],["__scopeId","data-v-78103f38"]]);export{I as default};
