import{_ as t,n as e,s,aU as i,aV as a,V as d,aR as o,R as n,T as r,A as l,r as c,c as h,i as p,w as u,aN as m,d as f,aX as y,aY as g,aZ as D,o as I,g as T,k as A,t as C,q as S,p as v,ao as w}from"./index-oXtcu1jG.js";import{d as _}from"./dayjs.min.C73DX6gN.js";import{p as L}from"./address-item.DzriXGz8.js";import{p as b}from"./form-item.eLhekq9H.js";import{p as k}from"./form-item-input.u4fUP3sq.js";import{f as x}from"./file-choose.DGJur1BJ.js";import{e as P,h as U,i as N,g as V}from"./zhdnTradeApi.DtENn4FQ.js";import{T as j}from"./tradeConfig.Csb849zU.js";const R=t({components:{addressItem:L,pformItem:b,pformItemInput:k,fileChoose:x},data:()=>({id:null,draftId:null,loading:!1,skeleton:[{type:"line",num:3,gap:"20rpx",style:["width: 200rpx;marginTop: 50rpx;marginLeft: 30rpx;","marginLeft: 30rpx;marginRight: 30rpx;","width: 400rpx;marginBottom: 50rpx;marginLeft: 30rpx;"]}],typeList:j,payTypeList:[],typeListShow:!1,payTypeShow:!1,dateType:0,dateShow:!1,selectDate:"",editData:{estimatedShippingTime:"",deviationTime:1,source:"",sourceStr:"",serviceexecudate:"",serviceenddate:"",payTypes:[],payTypesStr:"",serviceReq:"",trailerContainerInfo:[],productname:"",product:"不限",ispush:!1,files:[]},originData:null,fileDatas:[],uploadedFiles:[],uploadStatus:[],editFiles:[],isUploading:!1,startAddressItem:null,endAddressItem:null,sendToList:[]}),onLoad(t){t.id&&(this.id=t.id),t.draftId&&(this.draftId=t.draftId),this.loadReviewTypeData(),t.draftId&&this.loadDraftData()},methods:{typeListClick(t){this.editData.source=t.id,this.editData.sourceStr=t.name,this.typeListShow=!1},typeListShowChange(t){this.typeListShow=t},payTypeClick(t){this.payTypeShow=!1,this.editData.payTypes=[t.name],this.editData.payTypesStr=t.name},payTypeShowChange(t){this.payTypeShow=t},chooseAddress(t){let s=this;e({url:"/pages/trade/address/address?position="+t,events:{selectedAddress:function(e){0==t?s.startAddressItem=e.address:s.endAddressItem=e.address}}})},editGoodsType(){let t=this;e({url:"/pages/trade/publishGoodsInfo?type=resource",events:{goodsEditChange:function(e){t.editData.product=e.goods}}})},editPrice(){let t=this;e({url:"/pages/trade/tradePrice",events:{tradeResourcePrice:function(e){t.editData.trailerContainerInfo=e.priceList,t.editData.trailerContainerInfoStr=e.priceStr}}})},chooseSendSupplier(){let t=this;var s="";const i=[];this.sendToList.length>0&&(this.sendToList.forEach((t=>{i.push(t.id)})),s=JSON.stringify(i)),e({url:"/pages/trade/tradeChooseCustomer?type=2",events:{selectSendCustomer:function(e){t.sendToList=e.items}},success:function(t){""!=s&&t.eventChannel.emit("customerList",{data:s})}})},chooseDate(t){this.dateType=t,0==t&&""!=this.editData.estimatedShippingTime?this.selectDate=new Date(this.editData.estimatedShippingTime):1==t&&""!=this.editData.serviceexecudate?this.selectDate=new Date(this.editData.serviceexecudate):2==t&&""!=this.editData.serviceenddate?this.selectDate=new Date(this.editData.serviceenddate):this.selectDate=new Date,this.dateShow=!0},dateChange(t){console.log(this.selectDate),this.dateShow=!1;const e=_(t.value).format("YYYY-MM-DD");0==this.dateType?this.editData.estimatedShippingTime=e:1==this.dateType?this.editData.serviceexecudate=e:2==this.dateType&&(this.editData.serviceenddate=e)},canSubmit(){return this.startAddressItem?this.endAddressItem?this.editData.product&&""!=this.editData.product?this.editData.productname&&""!=this.editData.productname?this.editData.trailerContainerInfo&&0!=this.editData.trailerContainerInfo.length?this.editData.serviceenddate&&""!=this.editData.serviceenddate&&!(!this.editData.serviceexecudate||""==this.editData.serviceexecudate)||this.toast("请选择价格有效期"):this.toast("请填写意向价格"):this.toast("请填写产品名称"):this.toast("请选择货种"):this.toast("请选择目的地"):this.toast("请选择起运地")},toast:t=>(s({title:t,icon:"none"}),!1),async saveDraft(){const t=i(this.editData),e=[];if(this.startAddressItem||this.endAddressItem){const t={};this.startAddressItem&&this.startAddressItem.id&&Object.assign(t,{startAddressId:this.startAddressItem.id,startAddress:this.startAddressItem.address,startCountry:this.startAddressItem.country,startProvince:this.startAddressItem.province,startCity:this.startAddressItem.city,startDistr:this.startAddressItem.district,startStationId:this.startAddressItem.addressid,startType:this.startAddressItem.type}),this.endAddressItem&&this.endAddressItem.id&&Object.assign(t,{endAddressId:this.endAddressItem.id,endAddress:this.endAddressItem.address,endCountry:this.endAddressItem.country,endProvince:this.endAddressItem.province,endCity:this.endAddressItem.city,endDistr:this.endAddressItem.district,endStationId:this.endAddressItem.addressid,endType:this.endAddressItem.type}),e.push(t)}if(t.addressList=e,await a(this.fileDatas,this.uploadedFiles,this.uploadStatus),this.uploadStatus.includes("fail"))return d(),s({title:"部分文件上传失败，请重试",icon:"none"}),void(this.isUploading=!1);const r=[];for(let s=0;s<this.fileDatas.length;s++){const t=this.fileDatas[s];let e={fileName:t.netName?t.netName:"",filePath:t.netPath?t.netPath:"",fileType:t.netType?t.netType:""};r.push(e)}t.files=r;const l=[],c=[];this.sendToList&&this.sendToList.length>0&&this.sendToList.forEach((t=>{t.supplierName&&c.push(t.supplierName),t.id&&l.push(t.id)})),t.acceptcompanysList=l,t.acceptcompanynamesList=c,t.type=1,P(t).then((t=>{this.isUploading=!1,d(),s({title:"已保存",icon:"success"}),o("tradeGoods-refresh",{}),n()})).catch((t=>{this.isUploading=!1,d(),s({title:t.data.msg?t.data.msg:"提交失败",icon:"error"})}))},async publishAction(){if(!this.canSubmit())return;const t=[{startAddressId:this.startAddressItem.id,startAddress:this.startAddressItem.address,startCountry:this.startAddressItem.country,startProvince:this.startAddressItem.province,startCity:this.startAddressItem.city,startDistr:this.startAddressItem.district,startStationId:this.startAddressItem.addressid,startType:this.startAddressItem.type,endAddressId:this.endAddressItem.id,endAddress:this.endAddressItem.address,endCountry:this.endAddressItem.country,endProvince:this.endAddressItem.province,endCity:this.endAddressItem.city,endDistr:this.endAddressItem.district,endStationId:this.endAddressItem.addressid,endType:this.endAddressItem.type}],e=i(this.editData);if(e.addressList=t,this.isUploading=!0,r({title:"正在提交...",mask:!0}),await a(this.fileDatas,this.uploadedFiles,this.uploadStatus),this.uploadStatus.includes("fail"))return d(),s({title:"部分文件上传失败，请重试",icon:"none"}),void(this.isUploading=!1);const l=[];for(let s=0;s<this.fileDatas.length;s++){const t=this.fileDatas[s];let e={fileName:t.netName?t.netName:"",filePath:t.netPath?t.netPath:"",fileType:t.netType?t.netType:""};l.push(e)}e.files=l;const c=[],h=[];this.sendToList&&this.sendToList.length>0&&this.sendToList.forEach((t=>{t.supplierName&&h.push(t.supplierName),t.id&&c.push(t.id)})),e.acceptcompanysList=c,e.acceptcompanynamesList=h,U(e).then((t=>{this.isUploading=!1,d(),s({title:"已提交",icon:"success"}),o("tradeResource-refresh",{}),n()})).catch((t=>{this.isUploading=!1,d(),s({title:t.data.msg?t.data.msg:"提交失败",icon:"error"})}))},loadReviewTypeData(){N().then((t=>{this.payTypeList=t.data})).catch((t=>{}))},loadDraftData(){this.loading=!0,V(this.draftId).then((t=>{this.loading=!1,this.originData=t.data,this.configEditData()})).catch((t=>{this.loading=!1}))},configEditData(){const t=this.originData;if(t.source){this.editData.source=t.source;for(var e=0;e<this.typeList.length;e++){const s=this.typeList[e];if(s.id==t.source){this.editData.sourceStr=s.name;break}}}if(this.editData.product=t.product,this.editData.trailerContainerInfo=t.trailerContainerInfo?t.trailerContainerInfo:[],this.editData.estimatedShippingTime=t.estimatedShippingTime?t.estimatedShippingTime:"",this.editData.goodWeightDeviation=t.goodWeightDeviation,this.editData.freight=t.freight,this.editData.serviceReq=t.serviceReq?t.serviceReq:"",this.editData.deviationTime=t.deviationTime?t.deviationTime:1,this.editData.serviceexecudate=t.serviceexecudate?t.serviceexecudate:"",this.editData.serviceenddate=t.serviceenddate?t.serviceenddate:"",t.payTypes&&t.payTypes.length>0&&(this.editData.payTypes=t.payTypes,this.editData.payTypesStr=t.payTypes.join("、")),t.files&&t.files.length>0){let e=t.files;e.forEach((t=>{t.netPath=t.filePath,t.netName=t.fileName})),this.editFiles=e}}}},[["render",function(t,e,s,i,a,d){const o=S,n=l("addressItem"),r=l("pformItem"),_=v,L=w,b=l("pformItemInput"),k=l("fileChoose"),x=c(h("u-switch"),m),P=c(h("u-icon"),f),U=c(h("u-action-sheet"),y),N=c(h("u-datetime-picker"),g),V=c(h("u-skeleton"),D);return I(),p(V,{loading:a.loading,animate:!0,skeleton:a.skeleton},{default:u((()=>[T(o,{class:"pr__bg"},{default:u((()=>[T(o,{class:"pr-line pr-section-bg"},{default:u((()=>[T(o,{class:"pr-line__top"},{default:u((()=>[T(o,{class:"pr-section-title"},{default:u((()=>[A("运输线路")])),_:1}),T(o,{class:"fi-ismust"},{default:u((()=>[A("必填")])),_:1})])),_:1}),T(n,{class:"u-m-t-20",startAddress:a.startAddressItem,endAddress:a.endAddressItem,onChooseAddress:d.chooseAddress},null,8,["startAddress","endAddress","onChooseAddress"])])),_:1}),T(o,{class:"pr-source pr-section-bg"},{default:u((()=>[T(o,{class:"pr-section-title"},{default:u((()=>[A("资源信息")])),_:1}),T(r,{title:"资源类型",onClick:e[0]||(e[0]=t=>a.typeListShow=!0),content:a.editData.sourceStr},null,8,["content"]),T(r,{title:"意向货种",onClick:d.editGoodsType,content:a.editData.product},null,8,["onClick","content"]),T(r,{title:"预计运输时间",bottomLine:!1,onClick:e[1]||(e[1]=t=>d.chooseDate(0)),content:a.editData.estimatedShippingTime},null,8,["content"])])),_:1}),T(o,{class:"pr-product pr-section-bg"},{default:u((()=>[T(o,{class:"pr-section-title"},{default:u((()=>[A("产品信息")])),_:1}),T(r,{title:"产品价格",content:a.editData.trailerContainerInfoStr,onClick:d.editPrice},null,8,["content","onClick"]),T(r,{title:"价格有效期开始",bottomLine:!1,content:a.editData.serviceexecudate,onClick:e[2]||(e[2]=t=>d.chooseDate(1))},null,8,["content"]),T(r,{title:"价格有效期结束",bottomLine:!1,content:a.editData.serviceenddate,onClick:e[3]||(e[3]=t=>d.chooseDate(2))},null,8,["content"])])),_:1}),T(o,{class:"pr-other pr-section-bg"},{default:u((()=>[T(o,{class:"pr-section-title"},{default:u((()=>[A("收款信息")])),_:1}),T(r,{title:"收款方式",onClick:e[4]||(e[4]=t=>a.payTypeShow=!0),content:a.editData.payTypesStr},null,8,["content"]),T(o,{class:"pr-other__remarkHead"},{default:u((()=>[T(_,{style:{"font-weight":"500",color:"#292a2b","font-size":"28rpx"}},{default:u((()=>[A("产品运费备注")])),_:1})])),_:1}),T(o,{class:"pr-other__editorBg"},{default:u((()=>[T(L,{class:"pr-other__editorBg__editor",modelValue:a.editData.serviceReq,"onUpdate:modelValue":e[5]||(e[5]=t=>a.editData.serviceReq=t),placeholder:"请输入产品运费备注信息","placeholder-style":{color:"#a8b0bc"},"auto-height":!0},null,8,["modelValue"])])),_:1})])),_:1}),T(o,{class:"pr-other pr-section-bg"},{default:u((()=>[T(o,{class:"pr-section-title"},{default:u((()=>[A("附加信息")])),_:1}),T(b,{title:"产品名称",modelValue:a.editData.productname,"onUpdate:modelValue":e[6]||(e[6]=t=>a.editData.productname=t)},null,8,["modelValue"]),T(o,{style:{"font-weight":"500",color:"#292a2b","font-size":"28rpx","margin-top":"20rpx"}},{default:u((()=>[A("附件上传")])),_:1}),T(k,{ref:"fileWrap",onFilesChange:t.fileChange,editFiles:a.editFiles},null,8,["onFilesChange","editFiles"])])),_:1}),T(o,{class:"pr-section-bg u-p-b-30"},{default:u((()=>[T(o,{class:"u-flex u-flex-items-center",style:{"justify-content":"space-between"}},{default:u((()=>[T(o,{class:"pr-section-title"},{default:u((()=>[A("平台资源推送")])),_:1}),T(x,{modelValue:a.editData.ispush,"onUpdate:modelValue":e[7]||(e[7]=t=>a.editData.ispush=t)},null,8,["modelValue"])])),_:1}),T(o,{class:"u-m-t-28 pr-push__desc"},{default:u((()=>[A("是否通过平台人工客服推送优质匹配资源信息。")])),_:1}),T(o,{class:"u-flex u-m-t-30",onClick:d.chooseSendSupplier},{default:u((()=>[T(_,{style:{"font-weight":"500",color:"#292a2b","font-size":"28rpx"}},{default:u((()=>[A("目标客户")])),_:1}),0==a.sendToList.length?(I(),p(_,{key:0,style:{"font-weight":"500",color:"#a8b0bc","font-size":"28rpx",flex:"1","text-align":"right"}},{default:u((()=>[A("请添加")])),_:1})):(I(),p(_,{key:1,style:{"font-weight":"500",color:"#292a2b","font-size":"28rpx",flex:"1","text-align":"right","margin-left":"20rpx"}},{default:u((()=>[A("已选择"+C(a.sendToList.length)+"个客户",1)])),_:1})),T(P,{class:"u-m-l-30",name:"arrow-right",color:"#a8b0bc"})])),_:1},8,["onClick"])])),_:1}),T(U,{actions:a.typeList,show:a.typeListShow,"onUpdate:show":d.typeListShowChange,closeOnClickOverlay:!0,closeOnClickAction:!0,cancelText:"取消",onSelect:d.typeListClick,onClose:e[8]||(e[8]=t=>a.typeListShow=!1)},null,8,["actions","show","onUpdate:show","onSelect"]),T(U,{actions:a.payTypeList,show:a.payTypeShow,"onUpdate:show":d.payTypeShowChange,closeOnClickOverlay:!0,closeOnClickAction:!0,cancelText:"取消",onSelect:d.payTypeClick,onClose:e[9]||(e[9]=t=>a.payTypeShow=!1)},null,8,["actions","show","onUpdate:show","onSelect"]),T(N,{modelValue:a.selectDate,"onUpdate:modelValue":e[10]||(e[10]=t=>a.selectDate=t),show:a.dateShow,mode:"date",closeOnClickOverlay:!0,onConfirm:d.dateChange,onClose:e[11]||(e[11]=t=>a.dateShow=!1),onCancel:e[12]||(e[12]=t=>a.dateShow=!1)},{default:u((()=>[A(">")])),_:1},8,["modelValue","show","onConfirm"])])),_:1}),T(o,{class:"pr-bottom"},{default:u((()=>[T(o,{onClick:d.saveDraft},{default:u((()=>[T(P,{"label-pos":"bottom",label:"保存草稿箱",name:"tags","label-size":"10","label-color":"#272e3f",size:"20"})])),_:1},8,["onClick"]),T(o,{class:"pr-bottom__btn",onClick:d.publishAction},{default:u((()=>[A("发布")])),_:1},8,["onClick"])])),_:1})])),_:1},8,["loading","skeleton"])}],["__scopeId","data-v-18f07e14"]]);export{R as default};
