import{_ as t,ak as i,n as e,cL as a,s as n,R as s,U as o,r as l,c as r,f as c,g as p,w as h,F as d,ab as u,q as f,a7 as g,d as m,o as x,ah as _,y as w,k as y,t as b,l as k,p as C,S as M,i as S,m as A}from"./index-B3fvMXoi.js";import{_ as z}from"./l-floating-panel.Dh4psWJI.js";import{b as B,c as j}from"./pythonApi.kJLAZc7b.js";import{b as L}from"./webApi.Ds-2Cs1x.js";import{A as F}from"./AmapUtil.CIrCVBrz.js";import{_ as v}from"./icon_arrow.Dhtc8TwB.js";import"./constants.mpH2PV74.js";const I=t({data(){const{windowHeight:t}=i();return{windowHeight:t,anchors:[50,Math.round(.4*t),Math.round(.8*t)],map:null,line:"",listCount:[],list:[],listLngLat:[],listBorderStation:[],listStation:[]}},onLoad(t){this.line=t.line,this.getCount(),this.getBorderStation(),this.getStation()},mounted(){F.createInstance()},methods:{search(t){if(0==t.length)return void(this.listCount=this.list);let i=[];for(let e of this.list)(e.start.includes(t)||e.end.includes(t))&&i.push(e);this.listCount=i},check(t){e({url:`/pages/allMenu/car2TrainDetail?cc=${t}&isOut=true`})},initMap(){null==this.map&&(this.map=new AMap.Map("container",{viewMode:"2D"}))},getCount(){a(this.line).then((t=>{0!=t.data.length?(this.list=t.data,this.listCount=t.data,this.listLngLat=t.geojson.features,setTimeout((()=>{this.initLine()}),200)):n({title:"班列信息为空",icon:"error"})}))},initLine(){this.initMap();for(let t of this.listLngLat){let i=new AMap.Polyline({path:t.geometry.coordinates,strokeColor:`#${Math.floor(16777215*Math.random()).toString(16)}`,strokeWeight:1,strokeOpacity:1,lineCap:"round",zIndex:50});this.map.add(i)}this.map.setFitView()},getBorderStation(){B().then((t=>{this.listBorderStation=t.data,this.listBorderStation.length>0&&setTimeout((()=>{this.initBorderPoints()}),200)}))},initBorderPoints(){this.initMap();for(let t of this.listBorderStation){let i=new AMap.Marker({map:this.map,position:[t.lon,t.lat],icon:new AMap.Icon({image:"/static/image/menu/icon_border_point.png",imageSize:new AMap.Size(15,15)}),zIndex:100});i.content=t.hzzm,i.on("click",this.addClick)}this.map.setFitView()},getStation(){L().then((t=>{this.listStation=t.features,this.listStation.length>0&&setTimeout((()=>{this.initCnPoints()}),200)}))},initCnPoints(){this.initMap();for(let t of this.listStation){let i=new AMap.Marker({map:this.map,position:t.geometry.coordinates,icon:new AMap.Icon({image:"/static/image/menu/icon_cn_point.png",imageSize:new AMap.Size(10,10)})});i.content=t.properties.name,i.on("click",this.addClick)}this.map.setFitView()},addClick(t){s({title:"查询中"}),j(t.target.content).then((i=>{if("ok"==i.msg){var e=[];e.push(`<p class='text_black_16'>${i.info.label2}</p>`),e.push(`<p class='text_gray_12'>位置：${i.info.city+i.info.qxmc}</p>`),e.push(`<p class='text_gray_12'>路局：${i.info.ljqc}</p>`),e.push(`<p class='text_blue_12' onclick"${void console.log("详情")}">查看详情</p>`),new AMap.InfoWindow({content:e.join(""),anchor:"bottom-center"}).open(this.map,t.target.getPosition())}else n({title:"没有数据",icon:"error"})})).catch((t=>{n({title:"没有数据",icon:"error"})})).finally((t=>{o()}))}},onPageScroll(t){t.scrollTop>400?this.bgColor="white":this.bgColor="transparent"}},[["render",function(t,i,e,a,n,s){const o=l(r("u-navbar"),u),B=f,j=l(r("u-search"),g),L=C,F=l(r("u-icon"),m),I=A,P=M,$=l(r("l-floating-panel"),z);return x(),c(d,null,[p(B,{class:"u-flex-column"},{default:h((()=>[p(o,{borderBottom:!1,bgColor:"transparent",title:n.line},null,8,["title"]),_("div",{id:"container",class:"map",style:w([{width:"100%"},"height:"+n.windowHeight+"px"])},null,4)])),_:1}),p($,{anchors:n.anchors,defaultAnchor:1},{default:h((()=>[p(B,{class:"u-flex-column",style:{padding:"30rpx"}},{default:h((()=>[p(j,{showAction:!1,placeholder:"请输入省市进行查询",onChange:s.search},null,8,["onChange"]),p(B,{class:"u-flex u-m-t-20"},{default:h((()=>[p(L,{style:{"font-size":"24rpx",color:"#292A2B"}},{default:h((()=>[y(" 通道数量 ")])),_:1}),p(L,{style:{"font-size":"24rpx",color:"#FAAD14","margin-left":"10rpx"}},{default:h((()=>[y(b(n.list.length),1)])),_:1})])),_:1}),p(P,{"scroll-y":"",style:w([{"margin-top":"20rpx"},"height:"+(n.anchors[2]-180)+"px"])},{default:h((()=>[(x(!0),c(d,null,k(n.listCount,((t,i)=>(x(),S(B,{key:i,class:"u-flex u-flex-items-center",style:{background:"#f8f9fd","border-radius":"8px",padding:"32rpx 24rpx","margin-top":"20rpx"}},{default:h((()=>[p(F,{name:"/static/image/share/icon_station_blue.png",size:"18"}),p(B,{class:"u-flex u-flex-items-center",style:{flex:"1",margin:"0 20rpx"}},{default:h((()=>[p(L,{style:{"font-size":"26rpx",color:"#272E3F","font-weight":"bold"}},{default:h((()=>[y(b(i+1+"."+t.start),1)])),_:2},1024),p(I,{src:v,style:{width:"22rpx",height:"8rpx",margin:"0 12rpx"}}),p(L,{style:{"font-size":"26rpx",color:"#272E3F","font-weight":"bold"}},{default:h((()=>[y(b(t.end),1)])),_:2},1024)])),_:2},1024),p(L,{style:{background:"white",border:"0.5px solid #2647ff","border-radius":"4px","font-size":"24rpx",color:"#2647FF",padding:"12rpx 24rpx"},onClick:i=>s.check(t.id)},{default:h((()=>[y(" 查看线路 ")])),_:2},1032,["onClick"])])),_:2},1024)))),128))])),_:1},8,["style"])])),_:1})])),_:1},8,["anchors"])],64)}],["__scopeId","data-v-525b4ad5"]]);export{I as default};
