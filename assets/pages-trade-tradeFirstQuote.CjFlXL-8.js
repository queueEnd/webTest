import{_ as t,A as e,o as a,i as o,w as s,g as i,k as l,t as n,p as r,q as d,bw as c,aI as u,R as h,U as p,s as f,aQ as m,Q as g,r as x,c as y,f as _,F as w,K as D,d as T,aV as C,b as L,aW as b,y as A,j as S,l as k,m as I}from"./index-B3fvMXoi.js";import{_ as B}from"./z-paging.Ctbk3ePi.js";import{p as W}from"./form-item.DA0uEMIA.js";import{p as U}from"./address-item.CNwFlJY0.js";import{t as N}from"./trade-select.B9mhUHns.js";import{t as z,a as P,T as E,B as R,g as M}from"./tradeConfig.BxhAxmwf.js";import{t as j,_ as v}from"./icon-minuso.BaakFujK.js";import{b as F,q as V}from"./zhdnTradeApi.Dx0rs8q0.js";import{_ as Z}from"./goods_detail.CfNRTAPm.js";import"./fuse.BI5DUiN0.js";const G=t({components:{pformItem:W,tradeSelect:N,tradeModifyLoad:j,tradeGoodsSimpleInfo:t({components:{pAddressItem:U},props:{goods:{type:Object,default:{}}}},[["render",function(t,c,u,h,p,f){const m=e("pAddressItem"),g=r,x=d;return a(),o(x,null,{default:s((()=>[i(m,{canChoose:!1,startAddress:u.goods.startAddressItem,endAddress:u.goods.endAddressItem},null,8,["startAddress","endAddress"]),i(x,null,{default:s((()=>[i(x,{class:"u-m-t-10 u-flex u-flex-between"},{default:s((()=>[i(g,{style:{"font-size":"26rpx",color:"#666E81"}},{default:s((()=>[l("货种")])),_:1}),i(g,{style:{"font-size":"26rpx",color:"#292A2B","font-weight":"500"}},{default:s((()=>[l(n(u.goods.product),1)])),_:1})])),_:1}),i(x,{class:"u-m-t-10 u-flex u-flex-between"},{default:s((()=>[i(g,{style:{"font-size":"26rpx",color:"#666E81"}},{default:s((()=>[l("货量")])),_:1}),i(g,{style:{"font-size":"26rpx",color:"#292A2B","font-weight":"500"}},{default:s((()=>[l(n(u.goods.goodWeight)+n(u.goods.goodWeightUnit)+" ±"+n(u.goods.goodWeightDeviation)+"%",1)])),_:1})])),_:1}),i(x,{class:"u-m-t-10 u-flex u-flex-between"},{default:s((()=>[i(g,{style:{"font-size":"26rpx",color:"#666E81"}},{default:s((()=>[l("预计发货")])),_:1}),i(g,{style:{"font-size":"26rpx",color:"#292A2B","font-weight":"500"}},{default:s((()=>[l(n(u.goods.estimatedShippingTime)+" ±"+n(u.goods.deviationTime)+"天",1)])),_:1})])),_:1})])),_:1})])),_:1})}]])},props:{id:{type:String,default:null}},data:()=>({loading:!1,timeData:{},quotationLimitTime:0,taxList:z,taxRateList:P,transTypeList:E,transTypeShow:!1,transTypeSelectItems:[],bulkLoadTypeList:R,bulkLoadTypeShow:!1,bulkLoadTypeSelectItems:[],currencyList:[{name:"RMB"},{name:"USD"},{name:"HKB"}],editData:{transportModeType:"",transportModeTypeStr:"",tax:"",taxRate:"",currency:"RMB"},taxListShow:!1,transTypeShow:!1,chooseTaxType:!1,weightLoadUnitShow:!1,weightLoadPlan:null,weightLoadBox:null,sourceData:{goodWeightUnit:"吨",goodWeight:"-",goodWeightDeviation:10},editPlanCarryItem:null,ooInfo:""}),onLoad(t){t.id&&this.loadSourceData()},watch:{sourceData:{handler(){this.sourceData.id&&M(this.sourceData)},immediate:!0}},methods:{loadSourceData(){this.loading=!0,F(this.id).then((t=>{this.loading=!1,this.sourceData=t.data})).catch((t=>{this.loading=!1}))},limitTimeChange(t){this.timeData=t},taxListShowChange(t){this.taxListShow=t},currencyListShowChange(t){this.currencyListShow=t},chooseTax(t){this.chooseTaxType=t,this.taxListShow=!0},taxListClick(t){this.chooseTaxType?this.editData.tax=t.name:this.editData.taxRate=t.name},currencyListClick(t){this.editData.currency=t.name},chooseTransType(){this.transTypeSelectItems=[{name:this.editData.transportModeTypeStr}],this.transTypeShow=!0},transTypeSelect(t){this.transTypeShow=!1,this.editData.transportModeTypeStr=t.name,this.editData.transportModeType=t.id},chooseBulkCargo(t,e){this.bulkLoadTypeSelectItems=[{name:e.product}],this.weightLoadPlan=t,this.editPlanCarryItem=e,this.bulkLoadTypeShow=!0},bulkLoadTypeSelect(t){this.bulkLoadTypeShow=!1,this.editPlanCarryItem.product=t.name,this.editPlanCarryItem.load=t.load,this.editPlanCarryItem.productWeight=String(t.load),this.computeBoxCarryCount(this.weightLoadPlan)},popToEditBoxLoad(t,e){this.weightLoadPlan=t,this.weightLoadBox=e,this.weightLoadUnitShow=!0},canEditBoxNum(t){return"02"!=this.sourceData.source&&("吨"==this.sourceData.goodWeightUnit&&2==t.type)},mixPlanTotalLoadWeight(t){let e=0;return t.containerInfo.forEach((t=>{const a=Number(t.productWeight),o=Number(t.productNum);e+=a>0&&o>0?a*o:0})),t.totalLoad=e,e},editBoxLoad(t){if(this.weightLoadBox&&this.weightLoadPlan){const e=Number(t);isNaN(e)||(this.weightLoadBox.load=Math.abs(e),this.weightLoadBox.productWeight=String(this.weightLoadBox.load)),this.computeBoxCarryCount(this.weightLoadPlan)}this.weightLoadUnitShow=!1},boxNumberChange(t,e,a){a.productNum=String(t.value),this.computeBoxPlanFreight(e)},pirceEditChange(t,e,a){a.price=t,this.computeBoxPlanFreight(e)},computeBoxCarryCount(t){const e=this.sourceData.goodWeight;"吨"==this.sourceData.goodWeightUnit&&e>0&&t.containerInfo.forEach((t=>{const a=Number(t.productWeight);if(isNaN(a)||0==a)t.productNum="0";else{const o=Math.ceil(e/a);t.productNum=String(o)}}))},computeBoxPlanFreight(t){const e=this.sourceData.goodWeight;{let a=0,o=0;t.containerInfo.forEach((t=>{const e=Number(t.price),o=Number(t.productNum);!isNaN(e)&!isNaN(o)&&(a+=e*o)})),o=a/e,t.freight=o,t.totalPrice=a,t.priceUnit=this.sourceData.goodWeightUnit}},sendAction(){if(""==this.editData.transportModeType)return void c("请选择运输方式");if(""==this.editData.freightTicketCategory)return void c("请选择发票类型");if(""==this.editData.freightTaxRate)return void c("请选择发票税率");let t=0;if(this.sourceData.userDesignedContainerInfo.forEach((e=>{e.freight>0&&t++})),0==t)return void c("至少需要填写一个报价");let e=this;u({title:"提示",content:`是否提交${t}个报价方案？`,success:t=>{t.confirm&&e.apiQuote()}})},apiQuote(){const t={type:2,resourceId:this.sourceData?this.sourceData.id:this.id,billType:this.editData.c,extrasCategory:"",transportModeType:this.editData.transportModeType,freightTaxRate:this.editData.taxRate,freightTicketCategory:this.editData.tax},e=[];this.sourceData.userDesignedContainerInfo.forEach((t=>{"0"!==t.freight&&t.freight>0&&e.push(t)})),t.userDesignedContainerInfo=e,h({title:"正在提交...",mask:!0}),V(t).then((t=>{p(),f({title:"已提交",icon:"success"}),m("tradeGoodsDetail-refresh",{}),g()})).catch((t=>{p(),f({title:t.data.msg?t.data.msg:"提交失败",icon:"error"})}))}}},[["render",function(t,c,u,h,p,f){const m=I,g=d,W=r,U=e("up-count-down"),N=e("tradeGoodsSimpleInfo"),z=e("pformItem"),P=x(y("u-line"),D),E=x(y("u-icon"),T),R=x(y("u-number-box"),C),M=x(y("u-input"),L),j=x(y("z-paging"),B),F=x(y("u-action-sheet"),b),V=e("tradeModifyLoad"),G=e("tradeSelect");return a(),_(w,null,[i(j,{style:{"background-color":"#f0f2f7"}},{bottom:s((()=>[i(g,{style:{"background-color":"#fff"}},{default:s((()=>[i(P,{color:"#666",style:{opacity:"0.4"}}),i(g,{style:{padding:"20rpx 30rpx 40rpx 30rpx"}},{default:s((()=>[i(g,{onClick:f.sendAction,style:{"line-height":"78rpx","font-size":"28rpx","font-weight":"500","text-align":"center","border-radius":"4px","background-color":"#2647FF",color:"#fff"}},{default:s((()=>[l(" 发送报价")])),_:1},8,["onClick"])])),_:1})])),_:1})])),default:s((()=>[i(g,{class:"u-m-b-60"},{default:s((()=>[i(g,{class:"rd-section-bg"},{default:s((()=>[i(m,{class:"rd-one-logo",src:Z}),i(g,{class:"rd-one-top"},{default:s((()=>[i(g,{class:"rd-one-top__title"},{default:s((()=>[l("意向价格/"+n(p.sourceData.goodWeightUnit),1)])),_:1}),i(g,{class:"rd-one-top__status",style:A({backgroundColor:p.sourceData.statusColor})},{default:s((()=>[l(n(p.sourceData.statusText),1)])),_:1},8,["style"])])),_:1}),i(g,{style:{display:"flex","justify-content":"space-between"}},{default:s((()=>[i(g,{class:"rd-one-price"},{default:s((()=>[i(W,{class:"rd-one-price__unit"},{default:s((()=>[l("¥")])),_:1}),i(W,{class:"rd-one-price__value"},{default:s((()=>[l(n(p.sourceData.intentionPrice),1)])),_:1})])),_:1})])),_:1}),i(g,{class:"rd-one-tiem"},{default:s((()=>[i(g,{class:"rd-one-tiem__title"},{default:s((()=>[l(n(0==p.sourceData.quotationLimitTime?"报价已结束":"距报价结束"),1)])),_:1}),p.sourceData.quotationLimitTime>0?(a(),o(U,{key:0,time:p.sourceData.quotationLimitTime,format:"HH:mm:ss",autoStart:"",millisecond:"",onChange:f.limitTimeChange},{default:s((()=>[i(g,{class:"tradeLimit-p"},{default:s((()=>[p.timeData.days&&p.timeData.days>0?(a(),o(g,{key:0,class:"tradeLimit-p_day"},{default:s((()=>[l(n(p.timeData.days),1)])),_:1})):S("",!0),p.timeData.days&&p.timeData.days>0?(a(),o(W,{key:1,class:"tradeLimit-p_dayunit"},{default:s((()=>[l("天")])),_:1})):S("",!0),i(g,{class:"tradeLimit-p_item"},{default:s((()=>[l(n(p.timeData.hours>10?p.timeData.hours:"0"+p.timeData.hours),1)])),_:1}),i(W,{class:"tradeLimit-p_doc"},{default:s((()=>[l(":")])),_:1}),i(g,{class:"tradeLimit-p_item"},{default:s((()=>[l(n(String(p.timeData.minutes).padStart(2,"0")),1)])),_:1}),i(W,{class:"tradeLimit-p_doc"},{default:s((()=>[l(":")])),_:1}),i(g,{class:"tradeLimit-p_item"},{default:s((()=>[l(n(String(p.timeData.seconds).padStart(2,"0")),1)])),_:1})])),_:1})])),_:1},8,["time","onChange"])):S("",!0)])),_:1})])),_:1}),i(g,{class:"rd-section-bg"},{default:s((()=>[i(g,{class:"rd-section-title"},{default:s((()=>[l("货源信息")])),_:1}),i(N,{class:"u-m-t-20",goods:p.sourceData},null,8,["goods"])])),_:1}),i(g,{class:"rd-section-bg",style:{"padding-bottom":"0"}},{default:s((()=>[i(g,{class:"rd-section-title"},{default:s((()=>[l("运输信息")])),_:1}),i(z,{title:"运输方式",onClick:f.chooseTransType,content:p.editData.transportModeTypeStr},null,8,["onClick","content"]),i(z,{title:"发票类型",onClick:c[0]||(c[0]=t=>f.chooseTax(!0)),content:p.editData.tax},null,8,["content"]),i(z,{title:"发票税率",onClick:c[1]||(c[1]=t=>f.chooseTax(!1)),content:p.editData.taxRate},null,8,["content"]),i(z,{title:"币种",onClick:c[2]||(c[2]=e=>t.currencyListShow=!0),content:p.editData.currency},null,8,["content"])])),_:1}),i(g,null,{default:s((()=>[(a(!0),_(w,null,k(p.sourceData.userDesignedContainerInfo,((e,r)=>(a(),o(g,{class:"rd-section-bg",key:r},{default:s((()=>[i(g,{class:"u-flex u-flex-between"},{default:s((()=>["02"==p.sourceData.source?(a(),o(g,{key:0,class:"rd-section-title"},{default:s((()=>[l(" 散杂货方案【"+n(e.containerInfo[0].product)+"】 ",1)])),_:2},1024)):e.containerInfo&&1==e.type?(a(),o(g,{key:1,class:"rd-section-title"},{default:s((()=>[l(n(1==e.type?"单箱方案":"组合方案")+"【"+n(1==e.type?e.containerInfo[0].product:"")+"】 ",1)])),_:2},1024)):e.containerInfo&&2==e.type?(a(),o(g,{key:2,class:"rd-section-title"},{default:s((()=>[l("组合方案")])),_:1})):S("",!0),i(g,{class:"u-flex u-flex-items-center",onClick:t.expandPlan},{default:s((()=>[i(g,{style:{"font-size":"26rpx"}},{default:s((()=>[l(n(e.freight)+"元/"+n(p.sourceData.goodWeightUnit),1)])),_:2},1024),i(m,{class:"u-m-l-10",src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAcCAMAAABF0y+mAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAABjUExURUdwTGZugWdvgX9/f2trhmdugmVugGdvgmZvgGZugW1tf2dugWZugWZugWZvgWVugGlwf2RugmZugX9/f2hsgGZugWdtgWdvgWZmd2ZugmdugmVvgWZmmWhvgWZwg2VugWZugc0igG0AAAAgdFJOUwDR+wIT9o1ehbIOhuP21FgiM+wGQl+axA/+mcQFZVBR7zEk1wAAAO5JREFUKM99k9sagiAQhCctKTHT8lDaYd//KRtAhayYq2X/j5WBETDKs50E2mU5FtWFaSV9p3XXJ6Yu6pmdjlxu2q1bbdsNl8fTxG4iZ5X6Qak6i9wsrbmvrPChquReTs75vfKKla6kRY6MMyt8qeLkDPSg8EOKjsBzpr9gyjPjz0agNTBx/l6Pu2veH0/nNyEcbdmIHC6muBxEGtsaCYcZWmrYBAdC7abtLbVs7zraQ0cDZmGHgAYMHWGPD7ow9N7KRD2zVqT1xptmdQmx64tefPTJoo8djUk8YHM01RxNFUZzCfU4aD2Mq1D//R3eIcAdjPfirYwAAAAASUVORK5CYII=",style:{width:"28rpx",height:"28rpx"}})])),_:2},1032,["onClick"])])),_:2},1024),i(g,{style:{"margin-top":"20rpx",padding:"24rpx 10rpx 14rpx 26rpx",background:"#f4f4f4","border-radius":"8px"}},{default:s((()=>[(a(!0),_(w,null,k(e.containerInfo,((t,r)=>(a(),o(g,null,{default:s((()=>[r>0?(a(),o(P,{key:0,class:"u-m-t-10 u-m-b-30",dashed:!0})):S("",!0),i(g,{class:"u-flex u-flex-items-center"},{default:s((()=>[i(g,null,{default:s((()=>[i(g,{class:"u-flex u-flex-items-center"},{default:s((()=>[i(g,{class:"u-flex u-flex-items-center",onClick:a=>f.chooseBulkCargo(e,t)},{default:s((()=>[i(W,{style:{color:"#292a2b","font-weight":"500"}},{default:s((()=>[l(n(t.product),1)])),_:2},1024),"02"==p.sourceData.source?(a(),o(E,{key:0,class:"u-m-l-8",name:"arrow-down",color:"#2647FF"})):S("",!0)])),_:2},1032,["onClick"]),f.canEditBoxNum(e)?(a(),o(R,{key:1,modelValue:t.productNum,"onUpdate:modelValue":e=>t.productNum=e,class:"u-m-l-20",min:0,max:1e3,name:t.product,onChange:a=>f.boxNumberChange(a,e,t)},{minus:s((()=>[i(g,{class:"pgoods-box-minus"},{default:s((()=>[i(m,{src:v,style:{width:"16rpx",height:"4rpx"}})])),_:1})])),input:s((()=>[i(g,{class:"pgoods-box-input"},{default:s((()=>[l(n(t.productNum),1)])),_:2},1024)])),plus:s((()=>[i(g,{class:"pgoods-box-plus"},{default:s((()=>[i(E,{name:"/static/image/trade/icon-add.png",size:"8"})])),_:1})])),_:2},1032,["modelValue","onUpdate:modelValue","name","onChange"])):(a(),o(g,{key:0,class:"pgoods-box-load-num"},{default:s((()=>[l(" x"+n(t.productNum),1)])),_:2},1024))])),_:2},1024),(a(),o(g,{key:0,class:"u-flex u-flex-items-center"},{default:s((()=>[i(W,{style:{color:"#666E81","font-size":"24rpx"}},{default:s((()=>[l("预计装载量:")])),_:1}),i(W,{style:{"margin-left":"4rpx",color:"#292A2B","font-size":"24rpx"}},{default:s((()=>[l(n(t.productWeight)+n(p.sourceData.goodWeightUnit),1)])),_:2},1024),i(W,{style:{"margin-left":"8rpx",color:"#2647ff","font-size":"24rpx","line-height":"60rpx"},onClick:a=>f.popToEditBoxLoad(e,t)},{default:s((()=>[l("修改")])),_:2},1032,["onClick"])])),_:2},1024))])),_:2},1024),i(M,{modelValue:t.price,"onUpdate:modelValue":e=>t.price=e,placeholder:"请出价",border:"false",type:"digit",inputAlign:"right",color:"#FF0003",clearable:!0,placeholderStyle:"color: #666e81;font-weight: 500;font-size: 26rpx;",fontSize:"36rpx",customStyle:{"font-family":"DIN Alternate, DIN Alternate-Bold","font-size":"36rpx"},suffixIcon:"edit-pen",onChange:a=>f.pirceEditChange(a,e,t)},null,8,["modelValue","onUpdate:modelValue","onChange"])])),_:2},1024)])),_:2},1024)))),256))])),_:2},1024),"吨"==p.sourceData.goodWeightUnit?(a(),o(g,{key:0,class:"u-flex u-flex-between u-m-t-20"},{default:s((()=>[i(W,{style:{color:"#666e81","font-size":"26rpx"}},{default:s((()=>[l("总可装载量")])),_:1}),i(W,{style:{color:"#292A2B","font-size":"26rpx"}},{default:s((()=>[l(n(f.mixPlanTotalLoadWeight(e))+n(p.sourceData.goodWeightUnit),1)])),_:2},1024)])),_:2},1024)):S("",!0),i(g,{class:"u-flex u-flex-between u-m-t-20"},{default:s((()=>[i(W,{style:{color:"#666e81","font-size":"26rpx"}},{default:s((()=>[l("总折合吨价")])),_:1}),i(W,{style:{color:"#292A2B","font-size":"26rpx"}},{default:s((()=>[l(n(e.freight)+"元/"+n(p.sourceData.goodWeightUnit),1)])),_:2},1024)])),_:2},1024),i(g,{class:"u-flex u-flex-between u-m-t-20"},{default:s((()=>[i(W,{style:{color:"#666e81","font-size":"26rpx"}},{default:s((()=>[l("合计总价")])),_:1}),i(W,{style:{color:"#292A2B","font-size":"30rpx","font-weight":"500"}},{default:s((()=>[l(n(e.totalPrice),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1})])),_:1}),i(F,{actions:p.currencyList,show:t.currencyListShow,"onUpdate:show":f.currencyListShowChange,closeOnClickOverlay:!0,closeOnClickAction:!0,cancelText:"取消",onSelect:f.currencyListClick},null,8,["actions","show","onUpdate:show","onSelect"]),i(F,{actions:p.chooseTaxType?p.taxList:p.taxRateList,show:p.taxListShow,"onUpdate:show":f.taxListShowChange,closeOnClickOverlay:!0,closeOnClickAction:!0,cancelText:"取消",onSelect:f.taxListClick},null,8,["actions","show","onUpdate:show","onSelect"]),i(V,{show:p.weightLoadUnitShow,box:p.weightLoadBox,onClose:c[3]||(c[3]=t=>p.weightLoadUnitShow=!1),onConfirm:f.editBoxLoad},null,8,["show","box","onConfirm"]),i(G,{show:p.transTypeShow,items:p.transTypeList,selectItems:p.transTypeSelectItems,onClose:c[4]||(c[4]=t=>p.transTypeShow=!1),onConfirm:f.transTypeSelect},null,8,["show","items","selectItems","onConfirm"]),i(G,{show:p.bulkLoadTypeShow,items:p.bulkLoadTypeList,selectItems:p.bulkLoadTypeSelectItems,onClose:c[5]||(c[5]=t=>p.bulkLoadTypeShow=!1),onConfirm:f.bulkLoadTypeSelect},null,8,["show","items","selectItems","onConfirm"])],64)}],["__scopeId","data-v-1cf4003b"]]);export{G as default};
