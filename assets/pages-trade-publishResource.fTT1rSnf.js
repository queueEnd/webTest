import{_ as e,n as t,s,aT as a,R as i,aU as d,U as o,aQ as n,Q as r,A as l,r as c,c as h,f as p,g as u,w as m,F as f,q as y,aM as D,d as S,aW as g,aX as C,o as T,k as _,i as w,t as I,p as A,an as v}from"./index-B3fvMXoi.js";import{d as b}from"./dayjs.min.C73DX6gN.js";import{p as k}from"./address-item.CNwFlJY0.js";import{p as x}from"./form-item.DA0uEMIA.js";import{p as L}from"./form-item-input.-4VTgKnM.js";import{f as U}from"./file-choose.BjwToCCu.js";import{h as V,i as j}from"./zhdnTradeApi.Dx0rs8q0.js";const F=e({components:{addressItem:k,pformItem:x,pformItemInput:L,fileChoose:U},data:()=>({typeList:[{name:"汽运资源",id:"01"},{name:"铁运资源",id:"02"},{name:"航运资源",id:"03"},{name:"江运资源",id:"04"},{name:"仓储资源",id:"05"}],payTypeList:[],typeListShow:!1,payTypeShow:!1,dateType:0,dateShow:!1,selectDate:"",editData:{estimatedShippingTime:"",estimatedShippingTimeStr:"",deviationTime:1,source:"",sourceStr:"",serviceexecudate:"",serviceexecudateStr:"",serviceenddate:"",serviceenddateStr:"",payTypes:[],payTypesStr:"",serviceReq:"",trailerContainerInfo:[],productname:"",product:"",ispush:!1,files:[]},fileDatas:[],uploadedFiles:[],uploadStatus:[],editFiles:[],isUploading:!1,startAddressItem:null,endAddressItem:null,sendToList:[]}),onLoad(){this.loadReviewTypeData()},methods:{typeListClick(e){this.editData.source=e.id,this.editData.sourceStr=e.name,this.typeListShow=!1},typeListShowChange(e){this.typeListShow=e},payTypeClick(e){this.payTypeShow=!1,this.editData.payTypes=[e.name],this.editData.payTypesStr=e.name},payTypeShowChange(e){this.payTypeShow=e},chooseAddress(e){let s=this;t({url:"/pages/trade/address/address?position="+e,events:{selectedAddress:function(t){0==e?s.startAddressItem=t.address:s.endAddressItem=t.address}}})},editGoodsType(){let e=this;t({url:"/pages/trade/publishGoodsInfo?type=resource",events:{goodsEditChange:function(t){e.editData.product=t.goods}}})},editPrice(){let e=this;t({url:"/pages/trade/tradePrice",events:{tradeResourcePrice:function(t){e.editData.trailerContainerInfo=t.priceList,e.editData.trailerContainerInfoStr=t.priceStr}}})},chooseSendSupplier(){let e=this;var s="";const a=[];this.sendToList.length>0&&(this.sendToList.forEach((e=>{a.push(e.id)})),s=JSON.stringify(a)),t({url:"/pages/trade/tradeChooseCustomer?type=2",events:{selectSendCustomer:function(t){e.sendToList=t.items}},success:function(e){""!=s&&e.eventChannel.emit("customerList",{data:s})}})},chooseDate(e){this.dateType=e,0==e&&""!=this.editData.estimatedShippingTimeStr?this.selectDate=new Date(this.editData.estimatedShippingTimeStr):1==e&&""!=this.editData.serviceexecudateStr?this.selectDate=new Date(this.editData.serviceexecudateStr):2==e&&""!=this.editData.serviceenddateStr?this.selectDate=new Date(this.editData.serviceenddateStr):this.selectDate=new Date,this.dateShow=!0},dateChange(e){console.log(this.selectDate),this.dateShow=!1;const t=b(e.value).format("YYYY-MM-DD");0==this.dateType?(this.editData.estimatedShippingTime=t,this.editData.estimatedShippingTimeStr=t):1==this.dateType?(this.editData.serviceexecudate=t,this.editData.serviceexecudateStr=t):2==this.dateType&&(this.editData.serviceenddate=t,this.editData.serviceenddateStr=t)},canSubmit(){return this.startAddressItem?this.endAddressItem?this.editData.product&&""!=this.editData.product?this.editData.productname&&""!=this.editData.productname?this.editData.trailerContainerInfo&&0!=this.editData.trailerContainerInfo.length?this.editData.serviceenddate&&""!=this.editData.serviceenddate&&!(!this.editData.serviceexecudate||""==this.editData.serviceexecudate)||this.toast("请选择价格有效期"):this.toast("请填写意向价格"):this.toast("请填写产品名称"):this.toast("请选择货种"):this.toast("请选择目的地"):this.toast("请选择起运地")},toast:e=>(s({title:e,icon:"none"}),!1),async saveDraft(){},async publishAction(){if(!this.canSubmit())return;const e=[{startAddressId:this.startAddressItem.id,startAddress:this.startAddressItem.address,startCountry:this.startAddressItem.country,startProvince:this.startAddressItem.province,startCity:this.startAddressItem.city,startDistr:this.startAddressItem.district,startStationId:this.startAddressItem.addressid,startType:this.startAddressItem.type,endAddressId:this.endAddressItem.id,endAddress:this.endAddressItem.address,endCountry:this.endAddressItem.country,endProvince:this.endAddressItem.province,endCity:this.endAddressItem.city,endDistr:this.endAddressItem.district,endStationId:this.endAddressItem.addressid,endType:this.endAddressItem.type}],t=a(this.editData);if(t.addressList=e,this.isUploading=!0,i({title:"正在提交...",mask:!0}),await d(this.fileDatas,this.uploadedFiles,this.uploadStatus),this.uploadStatus.includes("fail"))return o(),s({title:"部分文件上传失败，请重试",icon:"none"}),void(this.isUploading=!1);const l=[];for(let s=0;s<this.fileDatas.length;s++){const e=this.fileDatas[s];let t={fileName:e.netName?e.netName:"",filePath:e.netPath?e.netPath:"",fileType:e.netType?e.netType:""};l.push(t)}t.file=l,V(t).then((e=>{this.isUploading=!1,o(),s({title:"已提交",icon:"success"}),n("tradeResource-refresh",{}),r()})).catch((e=>{this.isUploading=!1,o(),s({title:e.data.msg?e.data.msg:"提交失败",icon:"error"})}))},loadReviewTypeData(){j().then((e=>{this.payTypeList=e.data})).catch((e=>{}))}}},[["render",function(e,t,s,a,i,d){const o=y,n=l("addressItem"),r=l("pformItem"),b=A,k=v,x=l("pformItemInput"),L=l("fileChoose"),U=c(h("u-switch"),D),V=c(h("u-icon"),S),j=c(h("u-action-sheet"),g),F=c(h("u-datetime-picker"),C);return T(),p(f,null,[u(o,{class:"pr__bg"},{default:m((()=>[u(o,{class:"pr-line pr-section-bg"},{default:m((()=>[u(o,{class:"pr-line__top"},{default:m((()=>[u(o,{class:"pr-section-title"},{default:m((()=>[_("运输线路")])),_:1}),u(o,{class:"fi-ismust"},{default:m((()=>[_("必填")])),_:1})])),_:1}),u(n,{class:"u-m-t-20",startAddress:i.startAddressItem,endAddress:i.endAddressItem,onChooseAddress:d.chooseAddress},null,8,["startAddress","endAddress","onChooseAddress"])])),_:1}),u(o,{class:"pr-source pr-section-bg"},{default:m((()=>[u(o,{class:"pr-section-title"},{default:m((()=>[_("资源信息")])),_:1}),u(r,{title:"资源类型",onClick:t[0]||(t[0]=e=>i.typeListShow=!0),content:i.editData.sourceStr},null,8,["content"]),u(r,{title:"意向货种",onClick:d.editGoodsType,content:i.editData.product},null,8,["onClick","content"]),u(r,{title:"预计运输时间",bottomLine:!1,onClick:t[1]||(t[1]=e=>d.chooseDate(0)),content:i.editData.estimatedShippingTimeStr},null,8,["content"])])),_:1}),u(o,{class:"pr-product pr-section-bg"},{default:m((()=>[u(o,{class:"pr-section-title"},{default:m((()=>[_("产品信息")])),_:1}),u(r,{title:"产品价格",content:i.editData.trailerContainerInfoStr,onClick:d.editPrice},null,8,["content","onClick"]),u(r,{title:"价格有效期开始",bottomLine:!1,content:i.editData.serviceexecudateStr,onClick:t[2]||(t[2]=e=>d.chooseDate(1))},null,8,["content"]),u(r,{title:"价格有效期结束",bottomLine:!1,content:i.editData.serviceenddateStr,onClick:t[3]||(t[3]=e=>d.chooseDate(2))},null,8,["content"])])),_:1}),u(o,{class:"pr-other pr-section-bg"},{default:m((()=>[u(o,{class:"pr-section-title"},{default:m((()=>[_("收款信息")])),_:1}),u(r,{title:"收款方式",onClick:t[4]||(t[4]=e=>i.payTypeShow=!0),content:i.editData.payTypesStr},null,8,["content"]),u(o,{class:"pr-other__remarkHead"},{default:m((()=>[u(b,{style:{"font-weight":"500",color:"#292a2b","font-size":"28rpx"}},{default:m((()=>[_("产品运费备注")])),_:1})])),_:1}),u(o,{class:"pr-other__editorBg"},{default:m((()=>[u(k,{class:"pr-other__editorBg__editor",modelValue:i.editData.serviceReq,"onUpdate:modelValue":t[5]||(t[5]=e=>i.editData.serviceReq=e),placeholder:"请输入产品运费备注信息","placeholder-style":{color:"#a8b0bc"},"auto-height":!0},null,8,["modelValue"])])),_:1})])),_:1}),u(o,{class:"pr-other pr-section-bg"},{default:m((()=>[u(o,{class:"pr-section-title"},{default:m((()=>[_("附加信息")])),_:1}),u(x,{title:"产品名称",modelValue:i.editData.productname,"onUpdate:modelValue":t[6]||(t[6]=e=>i.editData.productname=e)},null,8,["modelValue"]),u(o,{style:{"font-weight":"500",color:"#292a2b","font-size":"28rpx","margin-top":"20rpx"}},{default:m((()=>[_("附件上传")])),_:1}),u(L,{ref:"fileWrap",onFilesChange:e.fileChange,editFiles:i.editFiles},null,8,["onFilesChange","editFiles"])])),_:1}),u(o,{class:"pr-section-bg u-p-b-30"},{default:m((()=>[u(o,{class:"u-flex u-flex-items-center",style:{"justify-content":"space-between"}},{default:m((()=>[u(o,{class:"pr-section-title"},{default:m((()=>[_("平台资源推送")])),_:1}),u(U,{modelValue:i.editData.ispush,"onUpdate:modelValue":t[7]||(t[7]=e=>i.editData.ispush=e)},null,8,["modelValue"])])),_:1}),u(o,{class:"u-m-t-28 pr-push__desc"},{default:m((()=>[_("是否通过平台人工客服推送优质匹配资源信息。")])),_:1}),u(o,{class:"u-flex u-m-t-30",onClick:d.chooseSendSupplier},{default:m((()=>[u(b,{style:{"font-weight":"500",color:"#292a2b","font-size":"28rpx"}},{default:m((()=>[_("目标客户")])),_:1}),0==i.sendToList.length?(T(),w(b,{key:0,style:{"font-weight":"500",color:"#a8b0bc","font-size":"28rpx",flex:"1","text-align":"right"}},{default:m((()=>[_("请添加")])),_:1})):(T(),w(b,{key:1,style:{"font-weight":"500",color:"#292a2b","font-size":"28rpx",flex:"1","text-align":"right","margin-left":"20rpx"}},{default:m((()=>[_("已选择"+I(i.sendToList.length)+"个客户",1)])),_:1})),u(V,{class:"u-m-l-30",name:"arrow-right",color:"#a8b0bc"})])),_:1},8,["onClick"])])),_:1}),u(j,{actions:i.typeList,show:i.typeListShow,"onUpdate:show":d.typeListShowChange,closeOnClickOverlay:!0,closeOnClickAction:!0,cancelText:"取消",onSelect:d.typeListClick},null,8,["actions","show","onUpdate:show","onSelect"]),u(j,{actions:i.payTypeList,show:i.payTypeShow,"onUpdate:show":d.payTypeShowChange,closeOnClickOverlay:!0,closeOnClickAction:!0,cancelText:"取消",onSelect:d.payTypeClick},null,8,["actions","show","onUpdate:show","onSelect"]),u(F,{modelValue:i.selectDate,"onUpdate:modelValue":t[8]||(t[8]=e=>i.selectDate=e),show:i.dateShow,mode:"date",closeOnClickOverlay:!0,onConfirm:d.dateChange},null,8,["modelValue","show","onConfirm"])])),_:1}),u(o,{class:"pr-bottom"},{default:m((()=>[u(o,{onClick:d.saveDraft},{default:m((()=>[u(V,{"label-pos":"bottom",label:"保存草稿箱",name:"tags","label-size":"10","label-color":"#272e3f",size:"20"})])),_:1},8,["onClick"]),u(o,{class:"pr-bottom__btn",onClick:d.publishAction},{default:m((()=>[_("发布")])),_:1},8,["onClick"])])),_:1})],64)}],["__scopeId","data-v-c4635cbe"]]);export{F as default};
