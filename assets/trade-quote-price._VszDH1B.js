import{_ as t,r as e,K as o,c as a,o as i,i as l,w as n,g as s,k as u,t as r,f as c,F as d,l as p,q as f,p as h,m,d as x,aW as g,b as y,A as w,j as _,aJ as b,T as N,V as B,s as S,L as z,S as C,M as L}from"./index-FwbBwjbJ.js";import{r as q,q as P}from"./zhdnTradeApi.D1sQ_EGE.js";import{t as I,_ as A}from"./icon-minuso.B2DiVMTc.js";const k=""+new URL("trade_plan_ing-Dky3xedy.png",import.meta.url).href;const T=t({emits:["close","success"],components:{tradeQuotePlanInfo:t({props:{quotation:{type:Object,default:null},sourceData:{type:Object,default:null}},data:()=>({tool:{canAgreeQutation:!1,canQuotation:!1,canDisable:!1,canAgreeEnd:!1,canQuotationNext:!1},showModal:!1,supplierAgreeHtml:"",modalText:"",actionType:0,showQuotationPop:!1}),watch:{quotation:{handler(){if(this.quotation){const t=this.quotation.bargainingRecord[0];this.quotation.nowQuote=t;let e="";this.quotation.nowQuote.priceScheme.containerInfo.forEach((t=>{e.length,e=e+t.product+"*"+t.productNum})),this.quotation.boxCountInfo=e,this.quotation.checkStatus,this.simplyQuoteModelInfo()}},immediate:!0}},methods:{simplyQuoteModelInfo(){const t=[],e=this.quotation.nowQuote.priceScheme;let o="";e.containerInfo.forEach((t=>{o.length>0&&(o+="\n"),o+=`${t.product}*${t.productNum} 预计装载量 ${t.productWeight}吨`})),t.push({title:"装载方案:",value:o}),t.push({title:"折合单价:",value:e.freight+"元/"+e.priceUnit}),t.push({title:"合计总价:",value:"￥"+e.totalPrice}),this.quotation.planInfo=t}}},[["render",function(t,x,g,y,w,_){const b=f,N=h,B=m,S=e(a("u-line"),o);return i(),l(b,{class:"t-q-plan-container"},{default:n((()=>[s(b,{class:"t-q-plan-order"},{default:n((()=>[u(r(1==g.quotation.priceScheme.type?"单箱方案":"组合方案")+":"+r(g.quotation.code),1)])),_:1}),s(b,{style:{padding:"20rpx 26rpx 20rpx 26rpx"}},{default:n((()=>[(i(!0),c(d,null,p(g.quotation.nowQuote.priceScheme.containerInfo,((t,e)=>(i(),l(b,{key:e},{default:n((()=>[s(b,{style:{color:"#292a2b","font-weight":"500"}},{default:n((()=>[u(r(t.product),1)])),_:2},1024),s(b,{class:"u-flex u-flex-between"},{default:n((()=>[s(b,{class:"u-flex u-flex-items-center"},{default:n((()=>[s(N,{style:{color:"#666E81","font-size":"24rpx"}},{default:n((()=>[u("预计装载量:")])),_:1}),s(N,{style:{"margin-left":"4rpx",color:"#292A2B","font-size":"24rpx","font-weight":"500"}},{default:n((()=>[u(r(t.productWeight)+"吨",1)])),_:2},1024)])),_:2},1024),s(b,{style:{"z-index":"10"}},{default:n((()=>[s(N,{style:{"font-weight":"500","font-size":"30rpx"}},{default:n((()=>[u("￥")])),_:1}),s(N,{style:{color:"#292a2b","font-family":"DIN Alternate, DIN Alternate-Bold","font-size":"36rpx"}},{default:n((()=>[u(r(t.price),1)])),_:2},1024)])),_:2},1024),s(B,{class:"t-q-plan-status",src:k})])),_:2},1024)])),_:2},1024)))),128)),s(S,{class:"u-m-t-20",dashed:!0}),s(b,null,{default:n((()=>[s(b,{class:"u-flex u-flex-between u-m-t-20"},{default:n((()=>[s(N,{style:{color:"#666e81","font-size":"26rpx"}},{default:n((()=>[u("预计箱数量")])),_:1}),s(N,{style:{color:"#292A2B","font-size":"26rpx"}},{default:n((()=>[u(r(g.quotation.boxCountInfo),1)])),_:1})])),_:1}),s(b,{class:"u-flex u-flex-between u-m-t-20"},{default:n((()=>[s(N,{style:{color:"#666e81","font-size":"26rpx"}},{default:n((()=>[u("总折合吨价")])),_:1}),s(N,{style:{color:"#292A2B","font-size":"26rpx"}},{default:n((()=>[u(r(g.quotation.nowQuote.priceScheme.freight)+"元/"+r(g.quotation.nowQuote.priceScheme.priceUnit),1)])),_:1})])),_:1}),s(b,{class:"u-flex u-flex-between u-m-t-20"},{default:n((()=>[s(N,{style:{color:"#666e81","font-size":"26rpx"}},{default:n((()=>[u("最新报价时间")])),_:1}),s(N,{style:{color:"#292A2B","font-size":"26rpx"}},{default:n((()=>[u(r(g.quotation.nowQuote.createdate),1)])),_:1})])),_:1}),s(b,{class:"u-flex u-flex-between u-m-t-20"},{default:n((()=>[s(N,{style:{color:"#666e81","font-size":"26rpx"}},{default:n((()=>[u("合计总价")])),_:1}),s(N,{style:{color:"#292A2B","font-size":"30rpx","font-weight":"500"}},{default:n((()=>[u("￥"+r(g.quotation.nowQuote.priceScheme.totalPrice),1)])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})}],["__scopeId","data-v-06e30ea8"]]),tradeQuotationPlanBoxEdit:t({components:{tradeModifyLoad:I},props:{item:{type:Object,default:null},unit:{type:String,default:"吨"},source:{type:String,default:"01"},weight:{type:String,default:""}},watch:{item:{handler(){},immediate:!0}},data:()=>({weightLoadUnitShow:!1,weightLoadPlan:null,weightLoadBox:null}),methods:{popToEditBoxLoad(t,e){this.weightLoadPlan=t,this.weightLoadBox=e,this.weightLoadUnitShow=!0},canEditBoxNum(t){return"02"!=this.source&&("吨"==this.unit&&2==t.type)},editBoxLoad(t){if(this.weightLoadBox&&this.weightLoadPlan){const e=Number(t);isNaN(e)||(this.weightLoadBox.load=Math.abs(e),this.weightLoadBox.productWeight=String(this.weightLoadBox.load)),this.computeBoxCarryCount(this.weightLoadPlan)}this.weightLoadUnitShow=!1,this.computeBoxPlanFreight(this.weightLoadPlan)},boxNumberChange(t,e,o){o.productNum=String(t.value),this.computeBoxPlanFreight(e)},pirceEditChange(t,e,o){o.price=t,this.computeBoxPlanFreight(e)},computeBoxPlanFreight(t){const e=Number(this.weight);{let o=0,a=0;t.containerInfo.forEach((t=>{const e=Number(t.price),a=Number(t.productNum);!isNaN(e)&!isNaN(a)&&(o+=e*a)})),a=o/e,t.freight=a,t.totalPrice=o,t.priceUnit=this.unit}},mixPlanTotalLoadWeight(t){let e=0;return t.containerInfo.forEach((t=>{const o=Number(t.productWeight),a=Number(t.productNum);e+=o>0&&a>0?o*a:0})),t.totalLoad=e,e},computeBoxCarryCount(t){const e=Number(this.weight);"吨"==this.unit&&e>0&&t.containerInfo.forEach((t=>{const o=Number(t.productWeight);if(isNaN(o)||0==o)t.productNum="0";else{const a=Math.ceil(e/o);t.productNum=String(a)}}))}}},[["render",function(t,b,N,B,S,z){const C=e(a("u-line"),o),L=h,q=f,P=m,I=e(a("u-icon"),x),k=e(a("u-number-box"),g),T=e(a("u-input"),y),Q=w("tradeModifyLoad");return i(),c(d,null,[s(q,null,{default:n((()=>[s(q,{style:{"margin-top":"20rpx",padding:"24rpx 10rpx 14rpx 26rpx",background:"#f4f4f4","border-radius":"8px"}},{default:n((()=>[(i(!0),c(d,null,p(N.item.containerInfo,((t,e)=>(i(),l(q,null,{default:n((()=>[e>0?(i(),l(C,{key:0,class:"u-m-t-10 u-m-b-30",dashed:!0})):_("",!0),s(q,{class:"u-flex u-flex-items-center"},{default:n((()=>[s(q,null,{default:n((()=>[s(q,{class:"u-flex u-flex-items-center"},{default:n((()=>[s(L,{style:{color:"#292a2b","font-weight":"500"}},{default:n((()=>[u(r(t.product),1)])),_:2},1024),z.canEditBoxNum(N.item)?(i(),l(k,{key:1,modelValue:t.productNum,"onUpdate:modelValue":e=>t.productNum=e,class:"u-m-l-20",min:0,max:1e3,name:t.product,onChange:e=>z.boxNumberChange(e,N.item,t)},{minus:n((()=>[s(q,{class:"pgoods-box-minus"},{default:n((()=>[s(P,{src:A,style:{width:"16rpx",height:"4rpx"}})])),_:1})])),input:n((()=>[s(q,{class:"pgoods-box-input"},{default:n((()=>[u(r(t.productNum),1)])),_:2},1024)])),plus:n((()=>[s(q,{class:"pgoods-box-plus"},{default:n((()=>[s(I,{name:"/static/image/trade/icon-add.png",size:"8"})])),_:1})])),_:2},1032,["modelValue","onUpdate:modelValue","name","onChange"])):(i(),l(q,{key:0,class:"pgoods-box-load-num"},{default:n((()=>[u(" x"+r(t.productNum),1)])),_:2},1024))])),_:2},1024),(i(),l(q,{key:0,class:"u-flex u-flex-items-center"},{default:n((()=>[s(L,{style:{color:"#666E81","font-size":"24rpx"}},{default:n((()=>[u("预计装载量:")])),_:1}),s(L,{style:{"margin-left":"4rpx",color:"#292A2B","font-size":"24rpx"}},{default:n((()=>[u(r(t.productWeight)+r(N.unit),1)])),_:2},1024),s(L,{style:{"margin-left":"8rpx",color:"#2647ff","font-size":"24rpx","line-height":"60rpx"},onClick:e=>z.popToEditBoxLoad(N.item,t)},{default:n((()=>[u("修改")])),_:2},1032,["onClick"])])),_:2},1024))])),_:2},1024),s(T,{modelValue:t.price,"onUpdate:modelValue":e=>t.price=e,placeholder:"请出价",border:"false",type:"digit",inputAlign:"right",color:"#FF0003",clearable:!0,placeholderStyle:"color: #666e81;font-weight: 500;font-size: 26rpx;",fontSize:"36rpx",customStyle:{"font-family":"DIN Alternate, DIN Alternate-Bold","font-size":"36rpx"},suffixIcon:"edit-pen",onChange:e=>z.pirceEditChange(e,N.item,t)},null,8,["modelValue","onUpdate:modelValue","onChange"])])),_:2},1024)])),_:2},1024)))),256))])),_:1}),"吨"==N.unit?(i(),l(q,{key:0,class:"u-flex u-flex-between u-m-t-20"},{default:n((()=>[s(L,{style:{color:"#666e81","font-size":"26rpx"}},{default:n((()=>[u("总可装载量")])),_:1}),s(L,{style:{color:"#292A2B","font-size":"26rpx"}},{default:n((()=>[u(r(z.mixPlanTotalLoadWeight(N.item))+r(N.unit),1)])),_:1})])),_:1})):_("",!0),s(q,{class:"u-flex u-flex-between u-m-t-20"},{default:n((()=>[s(L,{style:{color:"#666e81","font-size":"26rpx"}},{default:n((()=>[u("总折合吨价")])),_:1}),s(L,{style:{color:"#292A2B","font-size":"26rpx"}},{default:n((()=>[u(r(N.item.freight)+"元/"+r(N.unit),1)])),_:1})])),_:1}),s(q,{class:"u-flex u-flex-between u-m-t-20"},{default:n((()=>[s(L,{style:{color:"#666e81","font-size":"26rpx"}},{default:n((()=>[u("合计总价")])),_:1}),s(L,{style:{color:"#292A2B","font-size":"30rpx","font-weight":"500"}},{default:n((()=>[u("￥"+r(N.item.totalPrice),1)])),_:1})])),_:1})])),_:1}),s(Q,{show:S.weightLoadUnitShow,box:S.weightLoadBox,onClose:b[0]||(b[0]=t=>S.weightLoadUnitShow=!1),onConfirm:z.editBoxLoad},null,8,["show","box","onConfirm"])],64)}],["__scopeId","data-v-045e75b0"]])},props:{show:{type:Boolean,default:!1},sourceData:{type:Object,default:null},item:{type:Object,default:null}},watch:{item:{handler(){this.item&&this.item.priceScheme?this.plan=this.item.priceScheme:this.plan=this.item},immediate:!0},show:{handler(){this.popShow=this.show},immediate:!0}},data:()=>({popShow:!1,plan:null}),methods:{closePop(){this.$emit("close")},confirmAction(){this.closePop();let t=this;b({title:"提示",content:"是否提交议价信息",success:e=>{e.confirm&&t.apiTradeTo()}})},apiTradeTo(){if(this.sourceData.isCreateBySelf){const t={priceId:this.item.id},e=this.plan;t.priceScheme=e,N({title:"正在提交..."}),q(t).then((t=>{B(),S({icon:"success",title:"已提交报价"}),this.$emit("success")})).catch((t=>{B(),t.data&&t.data.msg?S({title:t.data.msg,icon:"none"}):S({title:"网络请求失败，请稍后重试",icon:"none"})}))}else{const t={resourceId:this.sourceData.id,id:this.item.id,billType:this.item.billType,freightTicketCategory:this.item.freightTicketCategory,freightTaxRate:this.item.freightTaxRate,transportModeType:this.item.transportModeType},e=this.plan;t.priceScheme=e,N({title:"正在提交..."}),P(t).then((t=>{B(),S({icon:"success",title:"已提交报价"}),this.$emit("success")})).catch((t=>{B(),t.data&&t.data.msg?S({title:t.data.msg,icon:"none"}):S({title:"网络请求失败，请稍后重试",icon:"none"})}))}}}},[["render",function(t,r,c,d,p,h){const m=f,g=e(a("u-icon"),x),y=w("tradeQuotePlanInfo"),b=w("tradeQuotationPlanBoxEdit"),N=C,B=e(a("u-line"),o),S=L,q=e(a("u-popup"),z);return i(),l(q,{show:p.popShow,round:12,mode:"bottom",onClose:h.closePop},{default:n((()=>[s(m,null,{default:n((()=>[s(m,{class:"u-flex u-flex-items-center",style:{margin:"30rpx 30rpx 20rpx 30rpx","justify-content":"space-between"}},{default:n((()=>[s(m,{style:{"font-size":"30rpx","font-weight":"500",color:"#272e3f"}},{default:n((()=>[u("议价")])),_:1}),s(m,{style:{width:"120rpx","font-size":"23rpx",display:"flex","justify-content":"flex-end"},onClick:h.closePop},{default:n((()=>[s(g,{name:"close"})])),_:1},8,["onClick"])])),_:1})])),_:1}),s(N,{"scroll-y":"",style:{"max-height":"860rpx"}},{default:n((()=>[s(m,{style:{padding:"10rpx 30rpx 40rpx 30rpx"}},{default:n((()=>[s(m,{style:{border:"0.5px solid #e1e1e1","border-radius":"4px"}},{default:n((()=>[s(y,{canEdit:!1,sourceData:c.sourceData,quotation:c.item},null,8,["sourceData","quotation"])])),_:1}),s(m,{style:{"margin-top":"30rpx",color:"#292a2b","font-size":"30rpx"}},{default:n((()=>[u("编辑议价信息")])),_:1}),c.item?(i(),l(b,{key:0,source:c.sourceData.source,unit:c.sourceData.goodWeightUnit,weight:c.sourceData.goodWeight,item:p.plan},null,8,["source","unit","weight","item"])):_("",!0)])),_:1})])),_:1}),s(B),s(S,{class:"u-m-t-20 u-m-l-30 u-m-r-30",style:{"background-color":"#2647FF",color:"#fff"},onClick:h.confirmAction},{default:n((()=>[u("确定")])),_:1},8,["onClick"]),s(m,{style:{height:"50rpx"}})])),_:1},8,["show","onClose"])}]]);export{T as t};
