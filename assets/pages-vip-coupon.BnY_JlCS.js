import{_ as e,bU as t,c1 as s,c2 as o,R as a,T as n,c3 as l,V as i,r as c,c as p,i as u,w as r,a_ as d,o as f,g,k as h,t as m,f as y,l as x,F as _,p as b,q as k,h as I}from"./index-oXtcu1jG.js";import{_ as z}from"./uv-skeletons.Bd1_6wiO.js";import{_ as C}from"./z-paging.5yIaKEvz.js";import{o as F}from"./zhtuseful.CyewbK9i.js";const U=e({data:()=>({type:0,cType:-1,cUsage:-1,cId:null,gId:null,price:null,loading:!1,skeleton:F.listSkeleton,list:[]}),onLoad(e){e.type&&(this.type=Number(e.type)),e.cType&&(this.cType=Number(e.cType)),e.cUsage&&(this.cUsage=Number(e.cUsage)),e.gId&&(this.gId=e.gId),e.price&&(this.price=e.price),e.cId&&(this.cId=e.cId),this.onRefresh()},methods:{onRefresh(){this.loading=!0,0==this.type?this.gId?t({packageId:this.gId}).then((e=>{this.loading=!1,e.data.forEach((e=>{e.canUse=!0})),this.list=data,this.$refs.paging.complete()})).catch((e=>{this.loading=!1,this.$refs.paging.complete()})):s().then((e=>{this.loading=!1,this.matchCoupon(e.data),this.$refs.paging.complete()})).catch((e=>{this.loading=!1,this.$refs.paging.complete()})):o().then((e=>{this.loading=!1,this.list=e.data,this.$refs.paging.complete()})).catch((e=>{this.loading=!1,this.$refs.paging.complete()}))},matchCoupon(e){this.gId&&e.forEach((e=>{this.gId==e.coupon.memberPackageId||this.cType==e.coupon.type&&this.cUsage==e.coupon.usage&&Number(e.coupon.discount)<Number(this.price)?e.canUse=!0:e.canUse=!1})),this.list=e},useCoupon(e){if(1==e.status){this.getOpenerEventChannel().emit("useCoupon",e),a()}},getCoupon(e){n({title:"正在领取...",mask:!0}),l(e.id).then((e=>{i(),uni.$u.toast("已领取"),this.$refs.paging.reload()})).catch((e=>{i(),e.data&&e.data.msg?uni.$u.toast(e.data.msg):uni.$u.toast("领取失败"),this.$refs.paging.reload()}))}}},[["render",function(e,t,s,o,a,n){const l=b,i=k,F=c(p("u-empty"),d),U=c(p("uv-skeletons"),z),$=c(p("z-paging"),C);return f(),u($,{ref:"paging","refresher-only":"",onOnRefresh:n.onRefresh,style:{"background-color":"#F0F2F7"}},{default:r((()=>[g(U,{animate:!0,loading:a.loading,skeleton:a.skeleton},{default:r((()=>[g(F,{style:{"margin-top":"200rpx"},show:!a.loading&&0==a.list.length,icon:"/static/image/common/empty.png",width:"200rpx",height:"200rpx",text:" "},{default:r((()=>[g(i,{style:{display:"flex","flex-direction":"column","align-items":"center"}},{default:r((()=>[g(l,{style:{color:"#666E81"}},{default:r((()=>[h(m(1==a.type?"暂无可领取的优惠券":"暂无相关数据"),1)])),_:1}),g(l,{style:{color:"#999999","margin-top":"10rpx","font-size":"24rpx"}})])),_:1})])),_:1},8,["show"]),0==a.type?(f(),u(i,{key:0},{default:r((()=>[(f(!0),y(_,null,x(a.list,((e,t)=>(f(),u(i,{key:t,class:"bg_coupon u-flex u-flex-items-center",style:{margin:"20rpx 30rpx 0",padding:"0 20rpx",position:"relative"}},{default:r((()=>[g(i,{class:"u-flex u-flex-items-baseline"},{default:r((()=>[g(l,{style:{"font-size":"28rpx",color:"#FF0003"}},{default:r((()=>[h(" ￥ ")])),_:1}),g(l,{style:{"font-size":"44rpx",color:"#FF0003","font-weight":"bold"}},{default:r((()=>[h(m(Number(e.coupon.discount)),1)])),_:2},1024)])),_:2},1024),g(i,{class:"u-flex-column",style:{position:"absolute",left:"92px"}},{default:r((()=>[g(l,{style:{"font-size":"28rpx",color:"#292A2B","font-weight":"500"}},{default:r((()=>[h(m(e.coupon.name),1)])),_:2},1024),g(l,{style:{"font-size":"20rpx",color:"#666E81","margin-top":"28rpx"}},{default:r((()=>[h(" 有效期至："+m(e.coupon.endTime),1)])),_:2},1024)])),_:2},1024),e.canUse?(f(),u(l,{key:0,class:I(["coupon-btn",1==e.status?"":"coupon-btn-done"]),onClick:t=>n.useCoupon(e)},{default:r((()=>[h(m(1==e.status?"去使用":2==e.status?"已使用":"已过期"),1)])),_:2},1032,["class","onClick"])):(f(),u(l,{key:1,class:I(["coupon-btn",e.canUse?"":"coupon-btn-done"])},{default:r((()=>[h("不可用")])),_:2},1032,["class"]))])),_:2},1024)))),128))])),_:1})):(f(),u(i,{key:1},{default:r((()=>[(f(!0),y(_,null,x(a.list,((e,t)=>(f(),u(i,{key:t,class:"bg_coupon u-flex u-flex-items-center",style:{margin:"20rpx 30rpx 0",padding:"0 20rpx",position:"relative"}},{default:r((()=>[g(i,{class:"u-flex u-flex-items-baseline"},{default:r((()=>[g(l,{style:{"font-size":"28rpx",color:"#FF0003"}},{default:r((()=>[h(" ￥ ")])),_:1}),g(l,{style:{"font-size":"44rpx",color:"#FF0003","font-weight":"bold"}},{default:r((()=>[h(m(Number(e.discount)),1)])),_:2},1024)])),_:2},1024),g(i,{class:"u-flex-column",style:{position:"absolute",left:"92px"}},{default:r((()=>[g(l,{style:{"font-size":"28rpx",color:"#292A2B","font-weight":"500"}},{default:r((()=>[h(m(e.name),1)])),_:2},1024),g(l,{style:{"font-size":"20rpx",color:"#666E81","margin-top":"28rpx"}},{default:r((()=>[h(" 有效期至："+m(e.endTime),1)])),_:2},1024)])),_:2},1024),g(l,{class:"coupon-btn",onClick:t=>n.getCoupon(e)},{default:r((()=>[h(" 领取 ")])),_:2},1032,["onClick"])])),_:2},1024)))),128))])),_:1}))])),_:1},8,["loading","skeleton"])])),_:1},8,["onOnRefresh"])}],["__scopeId","data-v-81d6210f"]]);export{U as default};
